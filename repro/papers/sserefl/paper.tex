\title{Surface Source Extension, Reflection Case}
\author{William. W. Symes \thanks{The Rice Inversion Project,
Department of Computational and Applied Mathematics, Rice University,
Houston TX 77251-1892 USA, email {\tt symes@caam.rice.edu}.}}

\lefthead{Symes}

\righthead{Reflection SSE}

\maketitle
\begin{abstract}
FWI via surface source extension (SSE) applies equally well to reflection or transmission data. In the transmission case, it is asymptotically equivalent to a form of travel time tomography, fitting event slowness rather than arrival time. Use of this method for reflection data simply involves permitting reflectors in the velocity and other subsurface mechanical parameters. It is possible to analyze a simple layered medium special case in the plane wave domain. The analysis suggests that in fact reflection SSE cannot constructively update velocity in absence of correctly positioned reflectors, so more closely resembles so-called Reflection FWI than transmission SSE in its velocity updating capabilities. This theoretical result is supported by numerical experiments with 2D reflection data.
\end{abstract}

\section{Introduction}
FWI based on source extension has been around since the early 1990's,
and some versions are provably robust - converge from substantially
incorrect initial velocity models. However the theoretical robustness
results all pertain to purely transmission configurations, such as
crosswell or diving wave geometry. It has been an open question
whether source extended FWI remains robust if all kinematic
information in the data is in the form of reflection
moveout. Some numerical evidence for such robustness has appeared, but
in each case it is not obvious that post-critical events did not play
a role in the inversion.

The goal of this paper is to produce a proof that in one precisely
defined case and in a precisely defined sense, one particular variant
of source-extended FWI is {\em not} robust for inversion of reflection
data. This counterexample negates any general claim of robustness for
such methods of reflection inversion, of course.

Surface source extension, defined below, is the method investigated
here. The objective of the reasoning laid out in the following sections is
to explicitly calculate the gradient of a particular surface source
extended FWI objective. A context that permits such explicit
calculation is plane-wave propagation in a layered medium. An explicit
computation of the gradient at a homogeneous background medium with
data containing a single reflector shows that the gradient has
vanishing low-frequency components as the central data frequency goes
to infinity: in fact, the mean square in any fixed frequency band goes
to zero. Therefore a step in the negative gradient direction cannot
affect traveltimes significantly and therefore this technique cannot
produce a productive velocity update in this case.

It is important to note the contrast with other extension methods. The
surface source extended FWI objective in the closest analogue for
transmission, namely the estimation of a homogeneous velocity from one
or more transmission traces, has been shown to be locally convex
independent of data frequency content. Also, the subsurface offset
extended FWI objective for surface reflection data has been shown to
have similar properties.

The first of the following sections sets out the framework of this
study. It does {\em not} include mathematically complete definitions
or fully qualified statements of results - these may be found in their
entirety in later sections. Instead, it is intended to introduce the
concepts that figure in the main results, which are stated succinctly
in the third section. The  I will review plane-wave modeling, and construct
an asymptotic approximation to single-reflector plane wave data. In
the final section I will present the surface source extended FWI
objective and compute its gradient at a homogeneous background with
single reflector data. The main result will follow immediately from
this calculation.

I include several appendices, on 1D wave propagation and plane wave
reflection modeling, as this material is difficult to find in
sufficiently precise form.

Whenever convenient, I abbreviate ``surface source extended FWI'' as SSE-FWI.

\section{Preliminaries}


This paper will use linear acoustics in velocity-pressure form as its
model for wave motion. In this model, the space-time fields $p$ is excess
pressure, $\bv$ is particle velocity about equilibrium, $f$
represents an energy source as a defect in the acoustic constitutive
law. The bulk modulus $\kappa$ and density $\rho$ are positive functions of
spatial position. The acoustic wave system couples these quantities:
\begin{eqnarray}
\label{eqn:awe}
\frac{\partial p}{\partial t} + \kappa \nabla \cdot {\bf v} &=&
                                                                f \nonumber\\
\rho \frac{\partial {\bf v}}{\partial t} + \nabla p = 0 \nonumber\\
p,{\bf v}&=&0, t \ll 0
\end{eqnarray}
In terms of the solution of the system \ref{eqn:awe}, the modeling
operator is defined by
\begin{equation}
\label{eqn:fwd}
S[\kappa]f = p|_{z=z_r}
\end{equation}
Two special types of right-hand side are important in the discussion
to follow: isotropic point sources, of the form
\begin{equation}
  \label{eqn:ipr}
  f(\bx,t;\bx_s) = w(t)\delta(\bx-\bx_s).  
\end{equation}
and surface sources, of the form
\begin{equation}
  \label{eqn:ss}
  f(\bx,t;\bx_s) = u(x,y,t;x_s,y_s)\delta(z-z_s). 
\end{equation}
Point sources are a special case of surface sources. Introduce appropriately
parametrized versions of the modeling operator for these two cases:
\begin{eqnarray}
  \label{eqn:defpt}
 f(\bx,t;\bx_s) = w(t)\delta(\bx-\bx_s) & \Rightarrow & S[\kappa]f = S_p
  [\kappa]w\\ 
  \label{eqn:defss}
f(\bx,t;\bx_s) = u(x,y,t;x_s,y_s)\delta(z-z_s) & \Rightarrow & S[\kappa]f =
  S_s[\kappa]u
\end{eqnarray}

The standing assumption in this work is that observed data to be fit
is to good approximation the result of a point source. That is, there
are bulk modulus $\kappa_*(\bx)$ and source wavelet or pulse $w_*(t)$
so that
\begin{equation}
  \label{eqn:datadef}
  d = S_p[\kappa_*]w_*
\end{equation}
In equation \ref{eqn:datadef}, $d$ is a function of receiver position
$\bx_r$, source position $\bx_s$, and time $t$.

Full waveform inversion (FWI), as construed in this paper, means:
\begin{equation}
  \label{eqn:deffwi}
  \mbox{Given } d, \mbox{ find }\kappa \mbox{ and }w \mbox{ so that }d
  \approx S_p[\kappa]w.
\end{equation}
In the following paragraphs, I will discuss four approaches to FWI:

\subsection{``Straight'' FWI}

The standard approach to FWI is to formulate the task \ref{eqn:deffwi}
as a nonlinear least squares problem:
\begin{equation}
  \label{eqn:defols}
  \mbox{Given } d, \mbox{ find }\kappa \mbox{ and }w \mbox{ to
    minimize }
  \| d -  S_p[\kappa]w\|^2.
\end{equation}
Here the symbol $\|\cdot\|^2$ signifies {\em mean-square}, that is,
sum the squares of every value of the field between the vertical bars.

This concept was introduced in the 1980's
(\cite{BamChavLai:79,Tara:84a,KolbColLai:86,Crasetal:90},
and many other papers since then). Usually some form of regularization
is applied, to compensate for poorly determined aspects of $\kappa$
and/or $w$, as is explained in Tarantola's influential book
\cite[]{Tarantola:05}. The approach was of only academic interest
until roughly fifteen years ago, when 3D modeling and related computations
first became feasible at industrial scale, and evidence began to emerge 
that FWI offered potentially decisive improvements in imaging accuracy
over other inversion (imaging) methods, especially for construction of
large-scale earth model features
\cite[]{Plessix:10,Vigh:10}. In the last ten years, FWI has become
both a production service offered by the geophysical industry, and a
leading topic of both industry-oriented and academic research. 

As was understood very early in the evolution of FWI, the basic
least-squares formulation \ref{eqn:defols} suffers from a major
defect: the parameter spaces tend to be so large that only iterative
optimization (that is, a variant
of Newton's method) may feasibly be applied, due to computational cost
- this remains true today and for the foreseeable future - but these
method tend not to produce usable results unless the initial iterate
is in some sense ``good'' (predicts travel times to within a
half-wavelength) \cite[]{GauTarVir:86,Plessix:10}.``Good'' initial models are not always
available. Accordingly, a number of alternative approaches have been
proposed, many of them variations on the least squares theme, amongst
which are the three approaches described below.

\subsection{Source Extensions}

Careful analysis of the defect mentioned in the last paragraph shows
that the failure of iterative optimization applied to \ref{eqn:defols}
to converge (or at least to converge usefully quickly) appears to
arise from failure to fit the data: some parts of the oscillatory time
series $d(\cdot,t)$ overlap oscillations in $S_p[\kappa]w$, while
others do not. It seems reasonable to guess that this ``cycle skipping'' phenomenon 
could be avoided if the data could be fit throughout the inversion
process. That requirement in turn implies a modeling operator with
more degrees of freedom, that is, a bigger domain, than the basic
modeling operator $S_p$, which should produce the same results as
$S_p$ when applied to pairs of bulk moduli and isotropic point sources \ref{eqn:ipr}.

There is
well-established mathematical terminology for this relationship:
operator A is an {\em extension} of operator B if (i) the domain of $A$
contains the domain of $B$, and whenever $v$ is in the domain of $B$,
$Av = Bv$. Two extensions of $S_p$ already appear
above: the isotropic point radiator \ref{eqn:ipr} is a special case of
both the surface source \ref{eqn:ss}, which is in turn a special case
of the generic right-hand side in the system \ref{eqn:awe}. So the
domain of $S_s$ contains the domain of $S_p$, as does the domain of
$S$. From the relations \ref{eqn:specsrc}, $S$ and $S_s$ produce the
same result as $S_p$ when applied to sources in their common domain,
so these operators are both extensions of $S_p$.

Since these extensions of $S_p$ involve additional degrees of freedom
for the energy source in the system \ref{eqn:awe}, they have come to
be called {\em source extensions}. These are not the only source
extensions - see \cite{HuangNammourSymesDollizal:SEG19} for an
overview of source extensions and their properties. Extensions may
also be constructed by adding degrees of freedom to the coefficients
in the wave system (bulk modulus, in the present case), 
rather than the right hand side - see \cite{geoprosp:2008} for a
description of some of these {\em medium extensions}.

The purpose of any extension is to add options for data fitting,
thereby reducing the chances of cycle-skipping. As will be seen below,
both extension $S$ and $S_s$ permit arbitrarily accurate fitting of
essentially any data with essentially any bulk modulus field $\kappa$,
with proper choice of $f$ or $w$ respectively. However, the standing
assumption on the data $d$ is that it derives from a point source, per
\ref{eqn:datadef}. So the added degrees of freedom represented by the
extensions $S$ and $S_s$ must be suppressed somehow. As explained by
\cite{geoprosp:2008}, a convenient mechanism for suppression of the
extension degrees of freedom is a penalty term added to the objective
of the extended
version of the least squares problem \ref{eqn:defols}. Choice of penalty
term, along with choice of extension, characterizes each of the extended
inversion methods detailed in the next few paragraphs.

\subsubsection{Wavefield Reconstruction Inversion}
This concept was introduced by \cite{LeeuwenHerrmannWRI:13}, and further
developed by \cite{LeeuwenHerrmann:16,WangYingst:SEG16} and other
authors. It is based on the extension $S$ (equation \ref{eqn:fwd}), with full
space-time volume source $f$, and presumes that the correct point
source wavelet $w_*$ is known. 
\begin{equation}
  \label{eqn:defwri}
  \mbox{Given } d, \mbox{ find }\kappa \mbox{ and }f \mbox{ to
    minimize }
  \| d -  S[\kappa]f\|^2+\alpha^2\|f-w_*\delta(\cdot-\bx_s)\|^2.
\end{equation}
Evidently the difference $f-w_*\delta(\cdot-\bx_s)$ should be such
that the scaled sum-of-squares makes sense - this is always the case
for discretizations, but for the continuum limit entails an actual
assumption.

\cite{LeeuwenHerrmannWRI:13} posed this problem slightly
differently, in terms of the second order wave equation for the
pressure wavefield $p$. From this viewpoint, the 
second terms becomes a scaled mean square of the residual in the
wave equation. The formulation presented here is equivalent, and was
introduced by \cite{WangYingst:SEG16}. \cite{LeeuwenHerrmann:16} used
the variable projection method \cite[]{GolubPereyra:03}, eliminating the source $f$ in the
inner step and updating the bulk modulus (or an equivalent quantity)
in the outer step. In any penalty method, control of the penalty
parameter has a large influence on the speed of
convergence. \cite{Aghamiry:19} use an augmented Lagrangian algorithm
to minimize the influence of the penalty weight choice.

The Achilles' heel of Wavefield Reconstruction Inversion (WRI), in any of
the formulations described so far, is the necessity of storing a full
space time field, namely $f$ (or $p$). Especially for time-domain
formulation and high frequency waves, this storage requirement can be
formidable. In fact, ``most'' source fields $f$ are non-radiating,
that is, $S[\kappa]f=0$. The orthocomplement of this subspace of
non-radiating sources is the range of the adjoint operator
$S[\kappa]^T$. Therefore the sources may be re-parametrized as images of
$S[\kappa]^T$. Write $f = g + w_*\delta(\cdot-\bx_s)$: then the second term in
the objective displayed in \ref{eqn:defwri} is simply $\|g\|^2$.
Decompose $g = S[\kappa]^Te + n$, in
which $e$ is the same type of object as $d$ and $S[\kappa]n=0$ (that
is, $n$ is a non-radiating
source), and note that the decomposition is orthogonal. Then the WRI problem \ref{eqn:defwri} may be reformulated as
\begin{equation}
  \label{eqn:defwrireform}
  \mbox{Given } d, \mbox{ find }\kappa \mbox{ and }e \mbox{ to
    minimize }
  \| d -  S[\kappa]w_*\delta(\cdot-\bx_s) - S[\kappa]S[\kappa]^Te\|^2+\alpha^2\|S[\kappa]^Te\|^2.
\end{equation}
Note that $n$ has disappeared: {\em a priori} it does not contribute to the first
term, and $n \ne 0$ makes the second term larger. So minimization
necessarily entails the choice $n=0$.

This reformulation does {\em not} require storage of $d+1$-dimensional
fields, as does the original WRI formulation \ref{eqn:defwri}. The
field $e$ has taken the place of the space-time source $f$, and its
size is precisely the same as that of the data field $d$. Therefore
the extra memory cost over modeling is the same as another copy of
data. A close examination reveals that in computing the composition
$SS^T$ via time-stepping methods, the same simultaneity issue arises
as in all applications of the adjoint state method. However good
solutions are known \cite[]{Griewank:book}, and since precisely the
same issue arises in time-domain FWI, the cost is the same. Therefore,
it is this reformulation of WRI that will be analyzed below.

\subsubsection{Space-Time Extension}
\cite{HuangSymes:Geo18a} introduced a variant of WRI, also using the space-time extension, but not
requiring knowledge of the target point source wavelet $w_*$: in fact,
an estimate of this wavelet is a by-product of the algorithm. This
approach relies on an {\em annihilator}, a linear operator whose null
space is precisely the desired class of source models, in this case
isotropic point radiators. Such an operator can be used to generate a
quadratic form whose zero set is also the desired class, hence can be
used as a penalty in a nonlinear least squares objective, designed to
drive the source towards to the desired type. See \cite{geoprosp:2008}
for a discussion of annihilators in extended inversion.

The annihilator proposed by \cite{HuangSymes:Geo18a} is multiplication
by $|\bx-\bx_s|$, that is,
\begin{equation}
  \label{eqn:defann}
  Af(\bx,t;\bx_s) = |\bx-\bx_s|f(\bx,t;\bx_s).
\end{equation}
The space-time extension approach consists of solving the optimization
problem:
\begin{equation}
  \label{eqn:defste}
  \mbox{Given } d, \mbox{ find }\kappa \mbox{ and }f \mbox{ to
    minimize }
  \| d -  S[\kappa]f\|^2+\alpha^2\|Af\|^2.
\end{equation}
This problem can be reformulated in the same way as the WRI problem. Write
$f = w\delta(\cdot-\bx_s) + S[\kappa]^Te + n$, where $n$ is
non-radiating as before: then the problem \ref{eqn:defste} is
equivalent to
\[
   \mbox{Given } d, \mbox{ find }\kappa, w, e \mbox{ and }n \mbox{ to
     minimize }
 \]
\begin{equation}
  \label{eqn:defstereform}
  \| d -  S[\kappa]w_*\delta(\cdot-\bx_s) - S[\kappa]S[\kappa]^Te\|^2+\alpha^2\|A(S[\kappa]^Te+n)\|^2.
\end{equation}
Note that the non-radiating component $n$ must remain in the second
term of the objective, because there is no reason for $n$ to be
$A^TA$-orthogonal to the range of $S[\kappa]^T$. Also, the isotropic
point radiator component $w\delta(\cdot-\bx_s)$ must also remain as
part of the unknowns - simply because it is unknown! It does not
appear in the second term because $A$ annihilates it.

\subsubsection{Surface Source Extension}
Beside the reformulation of WRI described above, it is also possible
to avoid the storage problem of WRI by limiting the support of the
extended source $f$ to lower dimensional sets. Of several
possibilities discussed in the literature, I will discuss the 
  surface source extension approach introduced by
\cite{HuangNammourSymesDollizal:SEG19}. The extension in question is
defined in equation \ref{eqn:defss}, and denoted $S_s$. The same
annihilator \ref{eqn:defann} is used in this approach, this time
interpreted as acting in the plane $z=z_s$, that is,
\[
  Au(x,y,t;x_s,y_s) = \sqrt{(x-x_s)^2+(y-y_s)^2}u(x,y,t;x_s,y_s).
\]
or
\[
  Au(x,t;x_s) = (x-x_s)u(x,t;x_s)
\]
for 2D. 
The problem formulation is
\begin{equation}
  \label{eqn:defsse}
  \mbox{Given } d, \mbox{ find }\kappa \mbox{ and }u \mbox{ to
    minimize }
  \| d -  S_s[\kappa]u\|^2+\alpha^2\|Au\|^2.
\end{equation}
Evidently the extended source has as many parameters as the data, so
the memory complexity of this problem is comparable to that of FWI or
reformulated WRI. The computational complexity compares favorably to
that of reformulated WRI.

\subsection{Layered Media, Plane Waves}
As explained in the introduction, this study explores the properties
of the various FWI variants explained above for the special case of
layered media: $\kappa = \kappa(z)$,
$\rho=\rho(z)$. Then the modeled shots differ from
each other by a horizontal translation, so that there is in effect
only one shot, for which I take the location to be
$\bx_s=(0,0,z_s)$.

If $\log \kappa$ and $\log \rho$ are globally bounded and $f$ has
compact support (and some other properties that will be made precise
later), there is $\xi_{\rm max} > 0$ so that for
$\|\xi\|<\xi_{\rm max}$, the integrals defining slant stack fields
$\tilde{p},\tilde{\bv}$, namely
\begin{eqnarray}
\label{eqn:slant}
\tp(\xi,z,t)& = &\int dx\, dy\, p(x,y,z,t+\xi x),\nonumber\\
\tv(\xi,z,t)&=&\int dx\, dy\, v_z(x,y,z,t+\xi x),\nonumber\\
\tf(\xi,z,t)&=&\int dx\,dy\, f(x,y,z,t+\xi x),
\end{eqnarray}
are absolutely convergent, and $\tp, \tv$ satisfy the plane wave
version of the acoustic system \ref{eqn:awe}:
\begin{eqnarray}
\label{eqn:awepw}
(1-c^2\xi^2)\frac{\partial \tp}{\partial t} + \kappa\frac{\partial
  \tv}{\partial z} &=& \tf \nonumber\\
\rho \frac{\partial \tv}{\partial t} + \frac{\partial \tp}{\partial
  z}&=&0\nonumber\\
\tp,\tv&=&0, t \ll 0.
\end{eqnarray}
Here $c=\sqrt{\kappa/\rho}$ is the sound velocity. I use $\xi$ instead
of the more usual $p$ for plane wave slowness since $p$ already has
been assigned to mean pressure. Note that for a isotropic point
source, respectively a surface source,
\begin{eqnarray}
  f(\bx,t;\bx_s)=w(t)\delta(\bx) & \Rightarrow &
                                               \tf(\xi,z,t)=w(t)\delta(z)\\ \nonumber 
  f(\bx,t;\bx_s) = u(x,y,t)\delta(z) & \Rightarrow &
                                                     \tf(\xi,z,t) =
                                                     \tu(\xi,t)\delta(z)\\
  \nonumber
  \tu(\xi,t) &=& \int dx\,dy\, u(x,y,t+\xi x)
\end{eqnarray}
The plane wave domain modeling
operator for space-time extended sources samples $\tp$ on $z=z_r$:
\begin{equation}
\label{eqn:modpw}
\tS[\kappa]\tf = \tp|_{z=z_r}
\end{equation}
Similarly, the plane wave domain versions of $S_p$ and $S_s$ are
\begin{eqnarray}
  \label{eqn:pwpt}
 \tf(\xi,z,t) = w(t)\delta(z-z_s) & \Rightarrow & \tS[\kappa]\tf = \tS_p
  [\kappa]w\\ 
  \label{eqn:pwss}
\tf(\xi,z,t) = \tu(\xi,t)\delta(z-z_s) & \Rightarrow & \tS[\kappa]\tf =
  \tS_s[\kappa]\tu
\end{eqnarray}

For homogeneous $\kappa=\kappa_0, \rho=\rho_0, c=c_0$, a computation
recapitulated in the Appendix C, relying on computations for the 1D
acoustics system detailed in Appendices A and B, yields
\begin{eqnarray}
  \label{eqn:ptmodhompw}
  \tS_p[\kappa_0]w(\xi,t) & = &\frac{1}{2c_0(1-c_0^2\xi^2)^{1/2}}w
                                \left(t-\frac{|z_r-z_s|}{\tc_0(\xi)}\right)\\
    \label{eqn:ssmodhompw}
  \tS_s[\kappa_0]\tu(\xi,t) & = &\frac{1}{2c_0(1-c_0^2\xi^2)^{1/2}}\tu 
                                  \left(\xi,t-\frac{|z_r-z_s|}{\tc_0(\xi)}\right)\\
    \label{eqn:stmodhompw}
  \tS[\kappa_0]\tf(\xi,t) & = &  \frac{1}{2c_0(1-c_0^2\xi^2)^{1/2}}\int dz \tf\left(\xi,z,t -
                                \frac{|z_r-z|}{\tc_0(\xi)}\right)                              
\end{eqnarray}
Here
\begin{equation}
  \label{eqn:vertvel}
  \tc(\xi,z) = \frac{c(z)}{\sqrt{1-c(z)^2\xi^2}}
    \end{equation}
is the vertical plane wave velocity, and we write
$\tc_0(\xi)=\tc(\xi,z)$ for any $z$, when $c=c_0$.

\subsection{Extended FWI in Plane Wave Domain}
Of the various extended FWI formulation explained above, three do not
require the storage of full space-time fields:
\begin{itemize}
\item Least-squares FWI;
\item Reformulated WRI; and
\item Surface Source Extension.
\end{itemize}
The remainder of this paper is devoted to analysis of these three
approaches.

It is possible to transform the objectives posed in the space-time
domain problem statements above, but this leads to technical
complications that do not affect the conclusions. Therefore I pose
analogous problems directly in the plane wave domain. The $L^2$ norms
(integral root mean squares) below involve integration over a range of
plane wave slownesses $\xi$, which for simplicity I assume symmetric,
that is, $-\xi_{\rm max} \le \xi \le \xi_{\rm max}$, and over
appropriate ranges of other variables which I do not state explicitly
here (see the analysis sections later in the paper where all such
choices are made explicitly). As before, the $L^2$-norm squared symbol
$\|\cdot\|^2$ means the integral over all variables of the square of
whatever is inside.

\subsubsection{Least Squares FWI}

\begin{equation}
  \label{eqn:defolspw}
  \mbox{Given } \td, \mbox{ find }\kappa \mbox{ and }w \mbox{ to
    minimize }
  \| \td -  \tS_p[\kappa]w\delta(\cdot-z_s)\|^2.
\end{equation}

\subsubsection{Reformulated WRI}

\begin{equation}
  \label{eqn:defwrireformpw}
  \mbox{Given } d, \mbox{ find }\kappa \mbox{ and }e \mbox{ to
    minimize }
  \| \td -  \tS[\kappa]w_*\delta(\cdot-z_s) - \tS[\kappa]\tS[\kappa]^Te\|^2+\alpha^2\|\tS[\kappa]^Te\|^2.
\end{equation}
                              
The reformulated WRI objective involves 
the product $\tS[\kappa]\tS[\kappa]^T$ in which $\tS[\kappa]^T$ is the
formal or $L^2$ adjoint. For the homogeneous case,
$\kappa=\kappa_0,\rho=\rho_0,c=c_0$,
\begin{equation}
  \label{eqn:stmodhompwtrans}
  (\tS[\kappa]^T\te)(\xi,z,t)=\frac{1}{2}(1-c_0^2\xi^2)^{-1}\te\left(\xi,t +
    \frac{|z_r-z|}{\tc_0(\xi)}\right).
\end{equation}

While I have endeavoured to limit mathematical technicalities in this background
presentation, one such technicality intrudes at this point: the
output of the transpose operator $\tS[\kappa]^T$ is nonzero and non-decaying arbitrarily
far in space and in negative time. As will be obvious shortly, this
fact prevents the composition $\tS[\kappa]\tS[\kappa]^T$ from being
well-defined, without some further constraint being imposed on the
domain of $\tS[\kappa]$. The simplest appears to be the assumption
that all plane wave sources act over a limited depth range, $z_{\rm min} \le z
\le z_{\rm max}$. Then the $z$ integrals appearing in the expressions
for $S$ and $\tS$ have limits $[z_{\rm min},z_{\rm max}]$

With this amendment, compute the composition:
\[
  \tS[\kappa_0]\tS[\kappa_0]^T\te(\xi,t) = \frac{1}{2}(1-c_0^2\xi^2)^{-1}
\]
\[
  \times 
  \int_{z_{\rm min}}^{z_{\rm max}} dz\, \frac{1}{2}(1-c_0^2\xi^2)^{-1}\te\left(\xi,t' +
    \frac{|z_r-z|}{\tc_0(\xi)}\right)_{t'=t-\frac{|z_r-z|}{\tc_0(\xi)}}
\]
\begin{equation}
  \label{eqn:stmodhompwnorm}
 = \frac{z_{\rm max}-z_{\rm min}}{4}(1-c_0^2\xi^2)^{-2}\te(\xi,t) 
\end{equation}

\subsubsection{Surface Source Extension}

The surface source space-time formulation employs an
annihilator $A$, defined in \ref{eqn:defste}. The corresponding
operator in the plane wave domain is somewhat easier to compute for the 2D
case: one obtains 
\[
\tA = D_{\xi}I_t,
\]
that is, differentiation in $\xi$ and integration in $t$, in either
order. The 3D expression is somewhat more complicated. Since the
examples below will be computed in 2D, the above definition suffices.

The surface source extended FWI problem in the plane wave domain is then
\begin{equation}
  \label{eqn:defssepw}
  \mbox{Given } \td, \mbox{ find }\kappa \mbox{ and }\tu \mbox{ to
    minimize }
  \| \td -  \tS_s[\kappa]\tu\|^2+\alpha^2\|\tA\tu\|^2.
\end{equation}

\subsection{Inversion Velocity Analysis: the zero penalty limit}
Examination of the operators appearing in the extended inversion
problems considered here (equations \ref{eqn:stmodhompwnorm} for
reformulated WRI, \ref{eqn:ssmodhompw} for SSE) reveals that they
are both invertible. This property permits a simplification of the
penalty formulations \ref{eqn:defwrireformpw} and
\ref{eqn:defssepw}. This simplification has been used several times in
prior work on extended FWI
\cite[]{Symes:EAGE15,Herve2017,HouSymes:Geo18}, and has come to be
called Inversion Velocity Analysis (IVA) in the exploration seismology
literature.

The idea is well-known in numerical optimization, and can most easily
be explained in the context of the SSE objective function, in
plane-wave domain:
\begin{equation}
  \label{eqn:ssepen}
  \kappa,\tu \mapsto \|\td-\tS_s[\kappa]\tu\|^2 + \alpha^2\|\tA\tu\|^2
\end{equation}

The transformation to IVA takes place in two steps. The first is
trivial: simply divide the objective function by $\alpha^2$, to
obtain
\begin{equation}
  \label{eqn:ssepeninv}
  \kappa,\tu \mapsto \alpha^{-2}\|\td-\tS_s[\kappa]\tu\|^2 + \|\tA\tu\|^2
\end{equation}
Only the minimum values change: for any particular $\alpha \in
\bR^+$, the sets of local and global minimizers are exactly the same.

The second step in moving from this objective to the corresponding IVA
objective is of value in itself: it consists of eliminating the linear
variable $\tu$ by minimizing the function defined in \ref{eqn:ssepen}
over $\tu$. The resulting minimum is a function of $\kappa$: {\em a
  priori}, a local minimizer is the same as the $\kappa$ component of
a local minimizer of the original objective. This reduction of the
objective to a function of some of its variables is known as the {\em
  Variable Projection Method} (VPM), especially if the eliminated variables
appear linearly in the original problem, as they do here
\cite[]{GolubPereyra:03}. For the plane wave surface source objective,
the result of VPM reduction is
\begin{equation}
  \label{eqn:ssevpm}
  \kappa \mapsto \alpha^{-2}\|\td-\tS_s[\kappa]\tu[\kappa]\|^2 + \|\tA\tu[\kappa]\|^2
\end{equation}
in which $\tu[\kappa]$ is the minimizer of the base objective
\ref{eqn:ssepeninv} over $\tu$, with $\kappa$ held fixed:
$\tu[\kappa]$ solves the {\em normal equation}
\begin{equation}
  \label{eqn:ssenorm}
  (\alpha^{-2}\tS_s[\kappa]^T\tS_s[\kappa] +
  \tA^T\tA)\tu[\kappa]=\alpha^{-2}\tS_s[\kappa]^T\td.
\end{equation}

The major import of VPM is that the gradient
of the reduced objective, a key element in any calculus-based
optimization algorithm, is relatively simple to compute: formally, it
is simply the gradient of the original objective with the
to-be-eliminated variables held fixed. See \cite{GolubPereyra:03} for
an explanation, and
\cite{vanLeeuwenMulder:09,Rickett:SEG12,LiRickettAbubakar:13} for
applications to geophysical inversion.

The final step is to observe that the VPM objective converges as
$\alpha \rightarrow 0$. Examination of \ref{eqn:ssepeninv} suggests
that for this to happen, the data must be fit perfectly, at least in
the limit. This is likely to happen only if the linear modeling
operator ($\tS_s[\kappa]$, in this case) is invertible - which it is,
at least in the case of constant $\kappa=\kappa_0$,
see equation \ref{eqn:ssmodhompw}.  In fact $\tS[\kappa]$ is a
continuous function of $\kappa$, as is explained in Appendix \appSingular, so in fact data is fit exactly and by precisely one $\tu$ for
all $\kappa$ sufficiently close to constant. It is not hard to see that the
$\alpha = 0$ limit of the VPM objective obtained from 
\ref{eqn:ssepeninv} is
\begin{equation}
  \label{eqn:ssiva}
  \kappa \mapsto \|A \tS_s[\kappa]^{-1}\td\|^2
\end{equation}
That is, the IVA objective is the mean square of the annihilator ouput
from the necessarily unique extended source field $\tu =
\tS_s[\kappa]^{-1}\td$ that precisely fits the data.

Appendix \appIVA  presents a proof that equation \ref{eqn:ssiva}
actually describes the $\alpha \rightarrow 0$ limit. The version of
surface source extended FWI whose properties are described in the next
section is the minimization problem for this objective, to which I
give a name:
\begin{equation}
  \label{eqn:defssiva}
  J_{\rm SSE} = \frac{1}{2}\|A\tu[\kappa]\|^2, \,
  \tu[\kappa]=\tS_s[\kappa]^{-1}\td
\end{equation}

The story for reformulated WRI is similar. From equation
\ref{eqn:defwrireformpw}, the VPM objective after scaling by
$\alpha^{-2}$ is 
\begin{equation}
  \label{eqn:wrivpm}
  \kappa, \te \mapsto \alpha^{-2}\| \td -  \tS[\kappa]w_*\delta(\cdot-z_s) -
  \tS[\kappa]\tS[\kappa]^T\te[\kappa]\|^2+\|\tS[\kappa]^T\te[\kappa]\|^2,
\end{equation}
in which $\te[\kappa]$ solves the normal equation
\begin{equation}
  \label{eqn:wrinorm}
  (\alpha^{-2}(\tS[\kappa]\tS[\kappa]^T)^2 +
  \tS[\kappa]\tS[\kappa]^T)\te[\kappa] =
  \alpha^{-2}\tS[\kappa]\tS[\kappa]^T(\td -
  \tS[\kappa]w_*\delta(\cdot-z_s) )
\end{equation}
If $\kappa$ is close to $\kappa_0$, then $\tS[\kappa]\tS[\kappa]^T$ is
invertible, as follows from equation \ref{eqn:stmodhompwnorm} and the
continuity of $\tS[\kappa]$ with respect to $\kappa$, mentioned
above. Therefore the normal equation is equivalent to
\begin{equation}
  \label{eqn:wrinorm1}
  (\alpha^{-2}\tS[\kappa]\tS[\kappa]^T +
  I)\te[\kappa] =
  \alpha^{-2}(\td -
  \tS[\kappa]w_*\delta(\cdot-z_s) )
\end{equation}
The $\alpha \rightarrow 0$ limit of the resulting function of
$\kappa$ is
\[
  J_{\rm WRI}[\kappa] = \frac{1}{2}\|\tS[\kappa]^T((\tS[\kappa]\tS[\kappa]^T)^{-1}(\td -
  \tS[\kappa]w_*\delta(\cdot-z_s)))\|^2
\]
\begin{equation}
  \label{eqn:wripwiva}
  = \frac{1}{2}\langle \td -
  \tS[\kappa]w_*\delta(\cdot-z_s), (\tS[\kappa]\tS[\kappa]^T)^{-1}( \td -
  \tS[\kappa]w_*\delta(\cdot-z_s)) \rangle
\end{equation}

Finally, it is entirely possible to apply VPM to the least squares FWI
objective \ref{eqn:defolspw}, as has been suggested as an algorithmic
approach to determining source parameters as part of FWI
\cite{Rickett:SEG12,LiRickettAbubakar:13}. However in this instance it
is more relevant to pose the known-source version of least squares
FWI, as most parallel to WRI (in any of its forms): recalling the
identity \ref{eqn:pwpt}, 
\[
  J_{\rm FWI}[\kappa] = \frac{1}{2}\|\td-\tS_p[\kappa]w_*\|^2 
\]
\begin{equation}
  \label{eqn:olspwobj}
  = \frac{1}{2}\langle \td -
  \tS[\kappa]w_*\delta(\cdot-z_s), \td -
  \tS[\kappa]w_*\delta(\cdot-z_s)\rangle.
\end{equation}
Comparing equations \ref{eqn:wripwiva} and \ref{eqn:olspwobj}, reach
the surprising conclusion that
\begin{quote}
  The $\alpha \rightarrow 0$ limit of the WRI-VPM objective
  \ref{eqn:wrivpm} is a weighted-norm variant of the FWI objective
  \ref{eqn:olspwobj}.
\end{quote}
This conclusion is surprising because one would normally expect the
opposite limit, that is $\alpha \rightarrow \infty$, of the WRI-VPM
objective \ref{eqn:wrivpm} to be equivalent in some sense to the FWI
objective \ref{eqn:olspwobj}, rather than the $\alpha \rightarrow 0$
limit. Indeed, the limit $\alpha \rightarrow \infty$ can only make
sense if $\tS[\kappa]\tS[\kappa]^T\te \rightarrow 0$: since
$\tS[\kappa]\tS[\kappa]^T$ is invertible for $\kappa$ near $\kappa_0$,
in that case $\te \rightarrow 0$ necessarily, so the objective
\ref{eqn:wrivpm} presumably tends to \ref{eqn:olspwobj}. This conclusion
is in fact correct, as follows from a variant of the argument
presented in Appendix \appIVA.

The import of the reasoning presented in Appendix \appIVA is that for
$\alpha$ sufficiently small, the behaviour of the VPM objective in
each of these cases is close to that of the $\alpha \rightarrow 0$
limit. As is well-known, and will be recapitulated in the Main Results
section, the least squares FWI objective does not generate
constructive model updates. Since all of the VPM objectives explored
here become close to the least squares FWI objective for large
$\alpha$, it is the case of small $\alpha$ that holds any possible
promise of generating substantially more constructive updates, and we
will see below that indeed in some cases that promise is realized. The
$\alpha \rightarrow 0$ limit provides a convenient window into
small $\alpha$ behaviour, so the focus in the remainder of the paper
will be on the limiting problems defined in \ref{eqn:olspwobj},
\ref{eqn:wripwiva}, and \ref{eqn:defssiva}.

\section{Main Results}

As explained in the introduction, the wave propagation regime implies
a separation of scales, between the propagation distance ($O(1)$ in
appropriate units), and the (smaller) wavelength scale. The results of
this paper are valid for ``small'' wavelengths, that is, as the
wavelength parameter $\lambda \rightarrow 0$. Wavelength is a data
property, induced by a corresponding feature of the source. Recall
the assumption that the data is (well-approximated by) point-source
data for an appropriate choice of acoustic parameter fields $\kappa$,
$\rho$. A convenient way of introducing wavelength as a parameter in
the acoustic dynamic fields is via a {\em family} of source wavelets $\wl$:
\[
\wl(t)=\frac{1}{\sqrt{\lambda}}w_1\left(\frac{t}{\lambda}\right)
\]
These wavelets are scaled to have constant power (mean-square)
independent of $\lambda$. As is reasonable, even mandatory, for simulation of seismic data, 
assume that the ``mother wavelet'' $w_1$ has at least two vanishing 
moments, that is, vanishes at zero frequency, and is smooth, that is,
also vanishes at zero wavelength. Also assume that the source acts
over a finite time interval.

Correspondingly, the target data is also a $\lambda$-dependent family:
\begin{equation}
  \label{eqn:datadef}
  \tdl = \tS_p[\kappa_*]\wl.
\end{equation}
in which $\kappa_*$ is the target bulk modulus, an estimate of which
is the object of the inversion exercise.

For each of the approaches mentioned in the last section, I will
analyze two cases, transmission and reflection. In all cases, $\kappa$
obeys Assumptions A - C, so that the system \ref{eqn:awepw} and its relatives have
well-defined solutions, thanks to the constructions presented in
Appendix \appSingular. 

\paragraph{Transmission:} $z_s < z_r$, $\kappa_*$ is smooth and and
differs from $\kappa_0$ only between $z_s$ and $z_r$: that is, $\kappa = \kappa_0$ for
$z < z_s+\epsilon$, $z>z_r-\epsilon$, suitable $\epsilon>0$. To ensure
that the data computed from $\kappa_*$ is distinct from the reference
data computed from $\kappa_0$, also assume that $\kappa \ge \kappa_0$,
and that $\kappa > \kappa_0$ over some subinterval of $[z_s,z_r]$ of
positive length.

Geometric acoustics implies that the solution for $\kappa_*$ is
asymptotic to the first term of the progressing wave expansion
[REFERENCE], which depends on the vertical
travel time $\tau_*(\xi,z_1,z_2)$ and geometric amplitude
$a_*(\xi,z_1,z_2)$ between depths $z_1$ and $z_2$. The traveltime is given by
\[
\tau(\xi,z_1,z_2) = \int_{z_1}^{z_2}\,dz\, \frac{1}{\tc_*(\xi,z)}.
\]
I do not give an explicit expression for the amplitude, noting only
that it is smooth in all three variables and positive.

The geometric
acoustics approximation of the data is
\begin{equation}
  \label{eqn:geosoltrans}
  \tdl(\xi,t) = a(\xi,z_s,z_r)\wl(t-\tau(\xi,z_s,z_r)) + O(\lambda). 
\end{equation}
The explicit expression \ref{eqn:ptmodhompw} for $\kappa_0$ may be 
viewed as a special case of \ref{eqn:geosoltrans}, and gives reference 
data for that case: 
\begin{equation}
  \label{eqn:analsoltrans}
  \td_{0,\lambda}(\xi,t) =  \tS_p[\kappa_0]\wl(\xi,t)  = \frac{1}{2c_0(1-c_0^2\xi^2)^{1/2}}\wl 
                                \left(t-\frac{|z_r-z_s|}{\tc_0(\xi)}\right) 
\end{equation}
The vertical travel time for $\kappa=\kappa_0$ is
\[
  \tau_0(\xi,z_1,z_2) = \frac{z_2-z_1}{\tc_0(\xi)}.
\]
A consequence of the assumptions about the relation between $\kappa_*$
and $\kappa_0$, stated above, is that $\tau_*(\xi,z_s,z_r) <
\tau_0(\xi,z_s,z_r)$ for $|\xi|\le \xi_{\rm max}$.

\paragraph{Reflection:}
In the reflection configuration, $z_r=z_s$, $\kappa_*(z)=\kappa_0$ for
$z<z_s$, and $\kappa_*$ is smooth except for a non-zero jump at $z=z_j
> z_s$. Geometric acoustics provides an approximate solution
containing a reflection for $z<z_j$, in particular at $z=z_s=z_r:$
\[
\tS[\kappa_*](\xi,t) = a(\xi,z_s,z_s)\wl(t) +
R(\xi)\wl\left(t-2\tau(\xi,z_s,z_j)\right) + O(\lambda)
\]
The reflection coefficient $R(\xi)$ is a function of the values of
$\kappa_*$ on either side of the jump, and of $\rho_0$. It is
generically non-zero except possibly for isolated values of $\xi$. Its precise
value is of no concern.

Having described these two configurations, I will now discuss the
behaviour of the three approaches to waveform inversion described in
the previous section, in each configuration. The crux of the matter is
the bahaviour of the gradient of the objective function in each case,
computed at the reference model $\kappa_0$,
as the wavelength parameter $\lambda \rightarrow 0$. Each objective -
the basic least squares objective in the first case, the IVA
objectives for the other two - is stable, in fact approaches a non-
zero limit. If the size of the gradient tends to zero, on the other
hand, then the gradient contains vanishingly little information about
constructive updates of $\kappa$ and gradient-based optimization
algorithms can be expected to perform poorly.

\subsection{Least Squares FWI}


wri

sse







\section{Derivations of Main Results}






\subsection{Least Squares FWI, Transmission Configuration}

The gradient of the objective, given in equation \ref{eqn:olspwobj},
is
\begin{equation}
  \label{eqn:fwigrad}
  \nabla J_{\rm FWI}[\kappa] = D\tS_p[\kappa]^T(\tS_p[\kappa]\wl-\tdl)
\end{equation}
The first step in this computation is 
For homogeneous background model $\kappa=\kappa_0$, Appendix \appPlane
develops an explicit expression 
\[
D(\tS_p[\kappa_0]\wl)_{\kappa=\kappa_0}\delta \kappa(\xi,t) =
  -\frac{1}{2\kappa_0c_0(1-c_0^2\xi^2)^{1/2}} \delta 
  \kappa(z_s) \wl\left(t - \frac{|z_r-z_s|}{\tc_0(\xi)}\right)
\]
\begin{equation}
\label{eqn:dmodhompwpt}
    + \frac{1}{4\kappa_0c_0^2(1-c_0^2\xi^2)} \int \,dz\,\delta 
  \kappa(z) \frac{\partial \wl}{\partial
    t}\left(t - \frac{|z_s-z|+|z-z_r|}{\tc_0(\xi)}\right)
\end{equation}
The conditions imposed on the transmission configuration imply that
$\delta \kappa(z) = 0$ for $z$ near $z_s$. This constraint implies that
\begin{equation}
  \label{eqn:dmodhompwpt0}
  D(\tS_p[\kappa]\wl)_{\kappa=\kappa_0}\delta \kappa(\xi,t) =
     \frac{1}{4\kappa_0c_0^2(1-c_0^2\xi^2)} \int \,dz\,\delta 
  \kappa(z)  \frac{\partial \wl}{\partial 
    t}\left(t - \frac{|z_s-z|+|z-z_r|}{\tc_0(\xi)}\right). 
\end{equation}
Furthermore, $\delta \kappa = 0$ for $z>z_r$ as well, which means that
the integral may be restricted to the interval $z_s \le z \le
z_r$. Thus in the range of integration, $|z_s-z| + |z_r-z|=z_r-z_s$
whence equation \ref{eqn:dmodhompwpt0} may be rewritten as
\begin{equation}
  \label{eqn:dmodhompwpt1}
  D(\tS_p[\kappa]\wl)_{\kappa=\kappa_0}\delta \kappa(\xi,t) =
     \frac{1}{4\kappa_0c_0^2(1-c_0^2\xi^2)} \frac{\partial \wl}{\partial 
    t}\left(t - \frac{z_r-z_s}{\tc_0(\xi)}\right) \left(\int_{z_s}^{z_r} \,dz\,\delta 
  \kappa(z) \right). 
\end{equation}
Note that the linearized transmission seismogram is only sensitive to
the average of $\delta \kappa$ between $z_s$ and $z_r$, which is in
turn proportional by a $\xi$-dependent factor to the perturbation in
travel time between source and receiver. Accordingly, the adjoint of
the linearized forward map outputs a $z$-independent bulk modulus perturbation:
\begin{equation}
\label{eqn:dmodhompwptadj}
D(\tS[\kappa]\wl)_{\kappa=\kappa_0}^T\td(z) =
\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi\,\int\,dt\,
\frac{1}{4\kappa_0c_0^2(1-c_0^2\xi^2)}
\frac{\partial w}{\partial
    t}\left(t - \frac{z_r-z_s}{\tc_0(\xi)}\right) \td(\xi,t).
\end{equation}

To compute the gradient \ref{eqn:fwigrad} at the homogeneous bulk
modulus $\kappa_0$, recall that the target data is
given by \ref{eqn:geosoltrans}, and the trial data for
$\kappa=\kappa_0$ by \ref{eqn:analsoltrans}. Insert these into the
right hand side of the identity \ref{eqn:fwigrad}:
\[
  \nabla J_{\rm FWI}[\kappa_0](z) =
  D(\tS[\kappa]\wl)_{\kappa=\kappa_0}^T(a_0\wl(t-\tau_0)
  -a\wl(t-\tau))(z) + O(\lambda)
\]
\[
=  \int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi\,\int\,dt\,
\frac{1}{4\kappa_0c_0^2(1-c_0^2\xi^2)}
\frac{\partial \wl}{\partial
    t}(t - \tau_0(\xi,z_s,z_r))
  \left(a_0(\xi,z_s,z_r)\wl(t-\tau_0(\xi,z_s,z_r) )\right.
\]
\[
-
\left.  a(\xi,z_s,z_r)\wl(t-\tau(\xi,z_s,z_r))\right) + O(\lambda)
\]
\[
  = \int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi\,
\frac{1}{4\kappa_0c_0^2(1-c_0^2\xi^2)}\left[a_0(\xi,z_s,z_r) \int \,
  dt \, \left(\frac{\partial \wl}{\partial t}\wl  \right)
  (t-\tau_0(\xi,z_s,z_r))
\right.
\]
\[
  \left.
- a(\xi,z_s,z_r) \int\,dt\,\frac{\partial \wl}{\partial t} 
  (t-\tau_0(\xi,z_s,z_r)) \wl(t-\tau(\xi,z_s,z_r)\right] + O(\lambda)
\]
The first of the two $t$ integrals vanishes because the integrand is
an exact derivative (of $\wl^2/2$) . The second vanishes when
$\lambda$ is small enough that the support of $\wl$ is smaller than
half of $\tau_0(\xi,z_s,z_r)-\tau(\xi,z_s,z_r)$ for $\xi$ in the
interval of integration. Therefore we conclude that
\[
  \nabla J_{\rm FWI}[\kappa_0] = O(\lambda)
\]
as stated in the last section.

\subsection{WRI, Transission Configuration}
In this configuration, $z_{\rm min}=z_s < z_r=z_{\rm max}$ and
\begin{equation}
  \label{eqn:writransupp}
  \mbox{supp }\tf \subset [-\xi_{\rm max},\xi_{\rm max}]\times
  [z_s,z_r]\times \bR.
\end{equation}
Recall that (equation \ref{eqn:wripwiva1} with $w_*=\wl$)
\begin{equation}
  \label{eqn:wripwiva1}
  J_{\rm WRI}[\kappa]   = \frac{1}{2}\langle \td -
  \tS_p[\kappa]\wl, (\tS[\kappa]\tS[\kappa]^T)^{-1}( \td -
  \tS[\kappa]\wl) \rangle  
\end{equation} 
Thus
\[
  D J_{\rm WRI}[\kappa]\delta \kappa|_{\kappa=\kappa_0}   =
  DJ_1[\kappa]\delta \kappa|_{\kappa=\kappa_0} +
  DJ_2[\kappa]\delta \kappa|_{\kappa=\kappa_0},
\]
in which
\[
  J_1[\kappa]   = \frac{1}{2}\langle \td -
  \tS_p[\kappa]\wl, (\tS[\kappa_0]\tS[\kappa_0]^T)^{-1}( \td -
  \tS_p[\kappa]\wl) \rangle 
\]
and
\[
 J_2[\kappa] =  \frac{1}{2}\langle \td -
  \tS_p[\kappa_0]\wl, (\tS[\kappa]\tS[\kappa]^T)^{-1}( \td -
  \tS_p[\kappa_0]\wl) \rangle
\]
Recall that 
\[
  \tS[\kappa_0]\tS[\kappa_0]^T\te(\xi,t) = \frac{z_{\rm max}-z_{\rm min}}{4}(1-c_0^2\xi^2)^{-2}\te(\xi,t).
\]
(equation \ref{eqn:stmodhompwnorm}). Thus $J_1$ is a statically
eqweighted version of $J_{\rm FWI}$. The estimation of $D J_{\rm
  FWI}[\kappa]\delta \kappa|_{\kappa=\kappa_0}$ follows exactly the
same pattern as the 
estimation of $D J_{\rm
  FWI}[\kappa]\delta \kappa|_{\kappa=\kappa_0}$ in the last section,
and yields
\begin{equation}
  \label{eqn:j1est}
  \nabla J_1[\kappa_0] = O(\lambda).
\end{equation}

To estimate $\nabla J_2[\kappa_0]$, abbreviate
\[
  \te=\td -
  \tS_p[\kappa_0]\wl 
\]
and note that
\[
  DJ_2[\kappa]\delta \kappa|_{\kappa=\kappa_0} = -
  \frac{1}{2}\langle \te,
  (\tS[\kappa_0]\tS[\kappa_0]^T)^{-1}\left((D\tS[\kappa]\delta
  \kappa)_{\kappa=\kappa_0}\tS[\kappa_0]^T\right.
\]
\[
  \left.+\tS[\kappa_0](D\tS[\kappa]\delta
  \kappa)_{\kappa=\kappa_0}^T\right) (\tS[\kappa_0]\tS[\kappa_0]^T)^{-1} \te\rangle
\]
\begin{equation}
  \label{eqn:dj2}
 = -\langle \te,(\tS[\kappa_0]\tS[\kappa_0]^T)^{-1}
  ((D\tS[\kappa]\delta
  \kappa)_{\kappa=\kappa_0}\tS[\kappa_0]^T)
  (\tS[\kappa_0]\tS[\kappa_0]^T)^{-1}\te\rangle
\end{equation}
Recall that $\mbox{supp }(\tf) \subset \{z_s \le z \le
z_r\}$, that is, the domain of $\tS$ is actually
$L^2([-\xi_{\rm max},\xi_{\rm max}] \times [z_s,z_r] \times
\bR)$. Injection of this domain into $L^2(\bR^3)$ is equivalent to
placing limits on the various integrals that appear in the definitions
of $\tS$ and related operators. For the adjoint, the dual projection
is part of the definition:
\begin{equation}
  (\tS[\kappa_0]^T\te)(\xi,z,t)=\frac{1}{2}(1-c_0^2\xi^2)^{-1}\te\left(\xi,t +
    \frac{|z_r-z|}{\tc_0(\xi)}\right), \,|\xi|\le \xi_{rm max}, z_s
  \le z \le z_r, \, =0 \mbox{ else}.
\end{equation}
(equation \ref{eqn:stmodhompwtrans}). From equation \ref{eqn:dmodhomst1app},
\[
  D(\tS[\kappa_0]\tf)_{\kappa=\kappa_0}\delta \kappa(\xi,t) =
  -\frac{1}{2\kappa_0c_0(1-c_0^2\xi^2)^{1/2}}\int \,dz_1\, \delta 
  \kappa(z_1) \tf \left(\xi,z_1,t - \frac{|z_r-z_1|}{\tc_0(\xi)}\right)
\]
\[
    + \frac{1}{4\kappa_0c_0^2(1-c_0^2\xi^2)} \int\,dz_2 \, \int \,dz_1\,\delta 
  \kappa(z_1)  \frac{\partial \tf}{\partial
    t}\left(\xi,z_2,t - \frac{|z_2-z_1|+|z_1-z_r|}{\tc_0(\xi)}\right)
\]
So
\[
 ( D\tS[\kappa]\delta \kappa) \tS^T[\kappa]\te(\xi,t) =
  -\frac{1}{4\kappa_0c_0}(1-c_0^2\xi^2)^{-3/2} \te(\xi,t)
  \int_{z_s}^{z_r}\,dz\,\delta \kappa (z)
\]
\begin{equation}
  \label{eqn:dmodhompwst2}
     + \frac{1}{8\kappa_0c_0^2(1-c_0^2\xi^2)^2} \int_{z_s}^{z_r}\,dz_2 \, \int_{z_s}^{z_r} \,dz_1\,\delta 
  \kappa(z_1)  \frac{\partial \te}{\partial
    t}\left(\xi,t - \frac{|z_2-z_1|+|z_1-z_r|-|z_r-z_2|}{\tc_0(\xi)}\right)
\end{equation}
The integral in the secont term splits naturally into the subdomains
\begin{eqnarray*}
 z_s \le z_2 \le z_1 \le z_r & \Rightarrow &
                                            |z_2-z_1|+|z_1-z_r|-|z_r-z_2|
                                            = z_1-z_2 + z_r-z_1 -
                                           ( z_r-z_2) = 0\\
z_s \le z_1 \le z_2\le z_r  & \Rightarrow
                                          &|z_2-z_1|+|z_1-z_r|-|z_r-z_2|
                                            = z_2-z_1 + z_r-z_1 -
                                            (z_r-z_2) = 2(z_2-z_1)
\end{eqnarray*}
So
\[
  \int_{z_s}^{z_r} \,dz_2\, \frac{\partial \te}{\partial 
    t}\left(\xi,t -
    \frac{|z_2-z_1|+|z_1-z_r|-|z_r-z_2|}{\tc_0(\xi)}\right) 
\]
\[
  = \int_{z_1}^{z_r} \,dz_2\, \frac{\partial
    \te}{\partial t}\left(\xi,t-\frac{2(z_2-z_1)}{\tc_0(\xi)}\right)
  + (z_1-z_s) \frac{\partial
    \te}{\partial t}(\xi,t)
\]
\[
=-\frac{\tc_0}{2}\int_{z_1}^{z_r} \,dz_2\, \frac{\partial}{\partial z_2}\te\left(\xi,t-\frac{2(z_2-z_1)}{\tc_0(\xi)}\right)
  + (z_1-z_s) \frac{\partial
    \te}{\partial t}(\xi,t)
\]
\[
  = -\frac{\tc_0}{2}\left(\te\left(\xi,t-\frac{2(z_r-z_1)}{\tc_0(\xi)}\right)-\te(\xi,t)\right)
    + (z_1-z_s) \frac{\partial
    \te}{\partial t}(\xi,t)
\]
so 
\[
  ( D\tS[\kappa]\delta \kappa) \tS^T[\kappa]\te(\xi,t) =
  \frac{1}{4\kappa_0c_0}\left(\frac{1}{4}(1-c_0^2\xi^2)^{-5/2}- (1-c_0^2\xi^2)^{-3/2}\right) \te(\xi,t)
  \int_{z_s}^{z_r}\,dz\,\delta \kappa (z)
\]
\begin{equation}
  \label{eqn:dmodhompwst3}
     + \frac{1}{8\kappa_0c_0^2(1-c_0^2\xi^2)^2}
     \int_{z_s}^{z_r}\,dz_1\,\delta\kappa(z_1) \left((z_1-z_s) \frac{\partial
    \te}{\partial t}(\xi,t) -\frac{\tc_0}{2}\te\left(\xi,t-\frac{2(z_r-z_1)}{\tc_0(\xi)}\right)\right)
\end{equation}
Therefore 
\[
  DJ_2[\kappa]\delta \kappa|_{\kappa=\kappa_0} = \left(\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi \,W_0(\xi)
  \int\,dt\, \te(\xi,t)^2\right)\int_{z_s}^{z_r}\,dz\,\delta \kappa
\]
\[
     -\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi\,W_1(\xi)\int\,dt\, \int_{z_s}^{z_r}\,dz_1\,\delta\kappa(z_1) \left((z_1-z_s) \te(\xi,t)\frac{\partial 
         \te}{\partial t}(\xi,t) \right.
     \]
\begin{equation}
  \label{eqn:dj2e1}
 \left.    -\frac{\tc_0}{2}\te(\xi,t)\te\left(\xi,t-\frac{2(z_r-z_1)}{\tc_0(\xi)}\right)\right)
\end{equation}
In the right-hand side of equation \ref{eqn:dj2e1}, $W_0$ and $W_1$
are functions of $\xi$, parametrized by $\kappa_0$ and $\rho_0$. They
have no depedence on the target model $\kappa_*,\rho_*$ used to
generate the target data $d$.

Note that the first summand under the integral sign in the second term
integrates to zero in $t$, as it is an exact derivative of a smooth
compactly supported function. Therefore combining equations
\ref{eqn:j1est} and \ref{eqn:dj2e1} and the definition of the formal
or $L^2$ gradient, obtain
\[
  \nabla J_{\rm WRI}[\kappa_0](z) = \left(\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi \,W_0(\xi)
    \int\,dt\, \te(\xi,t)^2\right) {\bf 1}_{[z_s,z_r]}(z)
\]
\begin{equation}
  \label{eqn:gradwri1}
  +\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi\,W_2(\xi)\int\,dt\, 
  \te(\xi,t)\te\left(\xi,t-\frac{2(z_r-z)}{\tc_0(\xi)}\right) + O(\lambda)
\end{equation}
in which $W_2 = (\tc_0/2)W_1$.

The inner ($t$) integral in the second term on the RHS of
\ref{eqn:gradwri1} is the autocorrelation of $\te$ at lag
$2(z_r-z)/\tc_0(\xi)$. Introducing the Fourier transform $\hat{\te}$
of $\te$ in $t$,
\[
  \nabla J_{\rm WRI}[\kappa_0](z) = \left(\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi \,W_0(\xi)
    \int\,dt\, \te(\xi,t)^2\right) {\bf 1}_{[z_s,z_r]}(z)
\]
\begin{equation}
  \label{eqn:gradwri2}
  +\frac{1}{2\pi}\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi\,W_2(\xi)\int\,d\omega\, 
  |\hat{\te}(\xi,\omega)|^2e^{-i\omega\frac{2(z_r-z)}{\tc_0(\xi)}} + O(\lambda)
\end{equation}
Recall that
\[
  \te=\tdl -
  \td_{0,\lambda}
\]
and
\begin{equation}
  \label{eqn:geosoltrans1}
  \tdl(\xi,t) = a(\xi,z_s,z_r)\wl(t-\tau(\xi,z_s,z_r)) + O(\lambda). 
\end{equation}
The explicit expression \ref{eqn:ptmodhompw} for $\kappa_0$ may be 
viewed as a special case of \ref{eqn:geosoltrans}, and gives reference 
data for that case: 
\begin{equation}
  \label{eqn:analsoltrans1}
  \td_{0,\lambda}(\xi,t) =  \tS_p[\kappa_0]\wl(\xi,t)  = a_0(\xi,z_s,z_r)\wl 
  \left(t-\frac{|z_r-z_s|}{\tc_0(\xi)}\right) 
\end{equation}
where $a_0$ is given in \ref{eqn:anasoltrans}. So
\[
  \te(\xi,t) = \tdl(\xi,t)-\td_{0,\lambda}(\xi,t) =
  \frac{1}{\sqrt{\lambda}}\te_1\left(\xi,\frac{t}{\lambda}\right) + O(\lambda),
\]
in which
\begin{equation}
  \label{eqn:e1def}
  \te_1 = \td_1 -\td_{0,1}.
\end{equation}
In terms of the Fourier transform,
\[
  \hat{\te}(\xi,\omega) = \sqrt{\lambda}\hat{\te}_1(\xi,\lambda\omega)
  + O(\lambda)
\]

Calculating the rate of change of traveltime between $z_s$ and $z_r$:
\[
  \delta \int_{z_s}^{z_r}\,\frac{1}{\tc}|_{\kappa=\kappa_0} =
  -\frac{\rho \tc_0}{\kappa_0^2} \int_{z_s}^{z_r}\,\delta \kappa
\]
The rate at $\kappa=\kappa_0$ in the direction $\delta \kappa =
-\nabla J_{\rm WRI}(\kappa_0)$ is therefore
\[
  = \left[(z_r-z_s) \left(\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi \, \frac{\rho \tc_0(\xi)}{\kappa_0^2} W_0(\xi)
    \int\,dt\, \te(\xi,t)^2\right)\right.
\]
\[
 \left. +\frac{1}{2\pi}\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi\,W_2(\xi)\int\,d\omega\, 
  |\hat{\te}(\xi,\omega)|^2 \int_{z_s}^{z_r}\, dz\,e^{-i\omega\frac{2(z_r-z)}{\tc_0(\xi)}} \right]+ O(\lambda)
\]
(all integrals are absolutely convergent hence can be interchanged)
\[
  = \left[(z_r-z_s) \left(\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi \, \frac{\rho \tc_0(\xi)}{\kappa_0^2} W_0(\xi) 
    \int\,dt\, \te(\xi,t)^2\right)\right. 
\]
\[
 \left. +\frac{1}{2\pi}\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi\, \frac{\rho \tc_0(\xi)}{\kappa_0^2} W_2(\xi)\int\,d\omega\, 
  \lambda|\hat{\te}_1(\xi,\lambda\omega)|^2 \int_{z_s}^{z_r}\, dz\,e^{-i\omega\frac{2(z_r-z)}{\tc_0(\xi)}} \right]+ O(\lambda) 
\]
\[
  = \left[(z_r-z_s) \left(\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi \, \frac{\rho \tc_0(\xi)}{\kappa_0^2} W_0(\xi) 
    \int\,dt\, \te(\xi,t)^2\right)\right. 
\]
\[
 \left. +\frac{1}{2\pi}\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi\, \frac{\rho \tc_0(\xi)}{\kappa_0^2} W_2(\xi)\lambda\int\,\frac{d\sigma}{\sigma}\, 
  |\hat{\te}_1(\xi,\sigma)|^2 \int_{z_s}^{z_r}\, dz\,e^{-i\sigma\frac{2(z_r-z)}{\lambda\tc_0(\xi)}} \right]+ O(\lambda) 
\]
\[
  = \left[(z_r-z_s) \left(\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi \, \frac{\rho \tc_0(\xi)}{\kappa_0^2} W_0(\xi) 
    \int\,dt\, \te(\xi,t)^2\right)\right. 
\]
\[
 \left. +\frac{1}{2\pi}\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi\, \frac{\rho \tc_0(\xi)}{\kappa_0^2} W_2(\xi)\lambda\int\,\frac{d\sigma}{\sigma}\, 
   |\hat{\te}_1(\xi,\sigma)|^2 \int_{z_s}^{z_r}\,
   dz\,\frac{\lambda\tc_0(\xi)}{2i\sigma}\frac{\partial}{\partial
       z}e^{-i\sigma\frac{2(z_r-z)}{\lambda\tc_0(\xi)}} \right]+ O(\lambda) 
\]
\[
  = \left[(z_r-z_s) \left(\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi \, \frac{\rho \tc_0(\xi)}{\kappa_0^2} W_0(\xi) 
    \int\,dt\, \te(\xi,t)^2\right)\right. 
\]
\[
 \left. +\frac{\lambda^2}{2\pi}\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi\, \frac{\rho \tc_0(\xi)^2}{\kappa_0^2} W_2(\xi)\int\,d\sigma\, 
   |\frac{\hat{\te}_1(\xi,\sigma)}{i\sigma}|^2 \frac{1}{2i}(1-e^{-i\sigma\frac{2(z_r-z_s)}{\lambda\tc_0(\xi)}}) \right]+ O(\lambda) 
\]

In view of the relation \ref{eqn:e1def}, the assumption that $w_1$ is
the derivative of a $C_0^{\infty}$ primitive, and the uniform boundedness of
the other factors in the integral with respect to $\lambda$, it
follows finally that the rate is
\begin{equation}
  \label{eqn:dttwri}
  =(z_r-z_s) \left(\int_{-\xi_{\rm max}}^{\xi_{\rm max}}\,d\xi \, \frac{\rho \tc_0(\xi)}{\kappa_0^2} W_0(\xi) 
    \int\,dt\, \te(\xi,t)^2\right) + O(\lambda)
\end{equation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{SSE Objective and Gradient: vanishing low frequencies}
In this section I will formulate the SSE objective, and calculate its
gradient at homogeneous background for single reflector data as
described in the last section. I will show that this gradient has
low-frequency content as the data wavelength $\lambda$, introduced in
the last section and in the introduction, tends to zero. 

FWI via SSE requires specification of an {\em annihilator}, the null
space of which consists of non-extended models, as explained in the
introduction.  Construct a suitable plane-wave domain annihilator
$\tA$ for
SSE by intertwining the Radon transform $R$ with the space-domain
annihilator $A = $ multiplication by offset. In order to do this
properly, it is necessary to introduce a cutoff in offset: not a
hardship, since infinite offsets are unavailable. Denote by $\chi$ a
offset mute. Define
\[
Rw(\chi,t) = \int \,dx\,\chi(x) w(x,t+\xi x)
\]
\[
Aw(x,t)=x w(x,t)
\]
\[
\tilde{A} Rw (\xi,t) = R Aw (\xi,t)
\]
\[
=\int dx x \chi(x) w(x,t+\xi x) = \int dx \chi(x)\frac{\partial}{\partial \xi}
I_tw(x,t+\xi x)
\]
\[
= D_{\xi} I_t R  w \equiv \tilde{A} Rw (\xi,t) 
\]

Since $\tS[\kappa]$ is continuous in $\kappa$
\cite[]{BlazekStolkSymes:13}, and $\tS[\kappa_0]$ is a multiple of the
identity, $\tS[\kappa]$ is invertible in sup-norm neighborhood of
$\kappa$.
Now assume that $\td$ is data computed from a simple reflector as
described in the previous section, depending on the wavelength
parameter $\lambda$:
\[
\td_{\lambda}(\xi,t) = a_0(\xi)\wl(t) +
R(\xi)\wl\left(t-2\tau(\xi,z_1)\right) + O(\lambda)
\]
Then
\begin{equation}
\label{eqn:wtildedef}
\tS[\kappa_0]^{-1}\td_{\lambda}(\xi,t) = \wl(t) +
\frac{R(\xi)}{a_0(\xi)}\wl\left(t-2\tau(\xi,z_1)\right) + O(\lambda)
\equiv \tw(\xi,t) + O(\lambda)
\end{equation}
Write 
\[
a_1(\xi)=\frac{1}{\kappa_0 (1-c_0^2\xi^2)^2}, \tc_0(\xi) =
\frac{c_0}{\sqrt{1-c_0^2\xi^2}}
\]
%Then
%\[
%DJ[\kappa_0]\delta \kappa =
%\left\langle \frac{c_0}{16\kappa_0 (1-c_0^2\xi^2)^{5/2}}\int
%\,ds\,\tw(\xi,t-s)(\delta \kappa)'
%\left(\frac{c_0s}{2\sqrt{1-c_0^2\xi^2}}\right), D_{\xi}^2I_t^2
%\tw(\xi,t) \right\rangle
%\]
%Per the derivation of simple reflection, presume that (1) $w_1(t) = 0$
%for $t>1$, and $w_1$ (hence $\wl$) has two vanishing moments, and (2) $\delta \kappa = 0 $ in an interval of positive
%length about $z=0$, and (3) $\lambda$ is small enough that $\wl(t)=0$
%if $\delta(\kappa)(t\tc/2) \ne 0$ for all $\xi$ for which $\chi(\xi)
%\ne 0$ (I.e. the range of the $\xi$ integral).

%Then the convolution of $\delta \kappa(t\tc/2)$ and $\wl$ vanishes for
%small $t$, hence the product with $\wl(t)$

%and 

From the definition \ref{eqn:j0def} of $J_0$ and a simple calculation,
\[
\nabla J[\kappa_0,\td] = (D\tS[\kappa_0]\tw)^T(\tS[\kappa_0]^T)^{-1}\tA^T\tA
\tS[\kappa_0]^{-1}\td,  \,\tw=\tS[\kappa_0]^{-1}\td
\]
Since $D_{\xi}$ and $I_t$ are both skew-symmetric and commute, $\tA$
is symmetric. $\tS$ is $\xi-$ dependent scaling. For simplicity
abbreviated the relation \ref{eqn:modhom} as
\[
\tS[\kappa_0]\tw(\xi,t) = a_0(\xi)\tw(\xi,t)
\]
Then
\[
\nabla J[\kappa_0](z) =
- 
\frac{1}{8} \int \,d\xi\,a_1(\xi)\frac{\partial}{\partial z} \int \,dt\, 
  \tw\left(\xi,t-\frac{2z}{\tc_0}\right)\left(D_{\xi}^2I_t^2 \tw(\xi,t)\right)
\]

\begin{equation}
\label{eqn:jgrad}
=-\frac{c_0}{16} \int \,d\xi\,a_1(\xi)\frac{\partial}{\partial z} \int \,dz'\, 
  \tw\left(\xi,\frac{2(z'-z)}{\tc_0}\right)\left(D_{\xi}^2I_z^2
    \tw\left(\xi,\frac{2z'}{\tc_0}\right)\right)
\end{equation} 
Set $u(\xi,z) = \tw(\xi,2z/\tc)$. Denote by $\hat{f}$ the Fourier
transform of $f$.  
\begin{equation}
\label{eqn:jgradft}
\widehat{\nabla J[\kappa_0]}(k) = -\frac{c_0}{16}\int\, d\xi\,a_1(\xi) 
\frac{1}{ik}\hat{u}(\xi,k)D_{\xi}^2\overline{\hat{u}(\xi,k)}
\end{equation}
From the definition \ref{eqn:wtildedef} of $\tw$,
\[
\hat{\tw}(\xi,\omega) = \left(1 + \frac{R(\xi)}{a_0(\xi)}e^{2i\omega\tau(\xi,z_1)}\right)\hat{\wl}(\omega)
\]
whence
\[
\hat{u}(\xi,k) = \left(1 +
  \frac{R(\xi)}{a_0(\xi)}e^{4ik\tau(\xi,z_1)/\tc(\xi)}\right)\hat{\wl}\left(\frac{2k}{\tc(\xi)}\right) 
\]
Together with the expression \ref{eqn:jgradft} for the Fourier
transform of the gradient, this observation establishes the assertion
stated in the introduction.

\append{Singular RIght-hand Sides and Weak Solutions}
Theorem 1 in \cite[]{BlazekStolkSymes:13} provides a strong solution of the system \ref{eqn:awe}: $p$, respectively $\bv$, is continuous
in time with values in the Sobolev space $H^1(\bR^d)$, respectively
$H^1_{\rm div}(\bR^d)$ and
also continuously differentiable with values in $L^2(\bR^d)$,
respectively $(L^2(\bR^d))^d$. Therefore all of the terms in
\ref{eqn:awe} are square-integrable functions.

Theorem 4 in \cite[]{BlazekStolkSymes:13} implies that for each $t$, $p(\cdot,t)$ and $\bv(\cdot,t)$
have compact support, and that the support expands in $t$ at the rate
bounded by the sup of the velocity $c=\sqrt{\kappa/\rho}$, as one
would expect. Therefore, for any fixed max time $T$, it is possible to
treat the problem for $0\le t \le T$ as a Dirichlet problem in a
domain $\Omega$ of sufficiently large diameter. Without loss of
generality, assume that $\mbox{supp }f \subset \Omega \times [0,T]$.

The isotropic point radiator \ref{eqn:ipr} is not
square-integrable, so the theory in \cite[]{BlazekStolkSymes:13} does
not apply directly to the system
\begin{eqnarray}
\label{eqn:aweptsrc}
\frac{\partial p}{\partial t} + \kappa \nabla \cdot {\bf v} &=&
                                                                w(t)\delta(\bx-\bx_s) \nonumber\\
\rho \frac{\partial {\bf v}}{\partial t} + \nabla p = 0 \nonumber\\
p,{\bf v}&=&0, t \ll 0
\end{eqnarray}
However there is a simple trick that makes this
theory applicable, provided one assumes that $\kappa$ is constant
($=\kappa_0 \in \bR^+$) near
$\bx=\bx_s$ (Assumption C). With this constraint, the problem
\ref{eqn:aweptsrc} may be shown to have a unique causal weak solution.,

Note that the existence of weak solutions for problems of this type
has been 
well-known for decades, with the additional assumption that the coefficients are
smooth, see for example \cite{Lax:PDENotes}. Using the progressing
wave expansion of the fundamental solution for smooth coefficient
problems (for example, \cite{Friedlander:75}) in place of the analytic
expression for the constant-coefficient point radiator solution given
below, it is possible to obtain a similar result under the weaker
\begin{itemize}
\item[Assumption C']: $\kappa$ is smooth near $\bx_s$.
\end{itemize}

Denote by $(p_0,\bv_0)$ the (weak) solution of the
system \ref{eqn:awe} with $\kappa$ replaced by $\kappa_0$. For $d=3$,
\[
 p_0(\bx,t) = \frac{1}{4\pi |\bx-\bx_s|}w\left(t-\frac{ |\bx-\bx_s|}{c_0}\right)
\]
in which $c_0=\sqrt{\kappa_0/\rho_0}$. There is a similar expression
for $\bv_0$, and for other space dimensions $d$. Because $w$ is smooth, both $p$ and $\bv$ are smooth
except at $\bx=\bx_s$. Pick $\phi \in C_0^{\infty}(\bR^d)$ so that
$\phi = 1$ in a neighborhood of $\bx_s$ and $\kappa=\kappa_0$ on
$\mbox{supp }\phi$. Then
\begin{eqnarray}
\label{eqn:awecut}
\frac{\partial (\phi p_0)}{\partial t} + \kappa \nabla \cdot (\phi {\bf v}_0) &=&
                           w(t)\delta(\bx-\bx_s) + f_0  \nonumber\\
\rho \frac{\partial (\phi {\bf v}_0)}{\partial t} + \nabla (\phi p_0) = {\bf g}_0 \nonumber\\
\end{eqnarray}
in which $f_0$ and ${\bf g}_0$ are smooth of compact support. Denote by
$(p_1,\bv_1)$ the strong solution of
\begin{eqnarray}
\label{eqn:awesupp}
\frac{\partial p_1}{\partial t} + \kappa \nabla \cdot {\bf v}_1 &=&
                                                                -f_0 \nonumber\\
\rho \frac{\partial {\bf v}_1}{\partial t} + \nabla p_1 = -{\bf g}_0 \nonumber\\
p_1,{\bf v}_1&=&0, t \ll 0
\end{eqnarray}
as provided by Theorem 1 of \cite{BlazekStolkSymes:13}. Then
\begin{eqnarray*}
  p & = & \phi p_0 + p_1\\
  \bv & = & \phi \bv_0 + \bv_1
\end{eqnarray*}
defines the unique weak solution of the system \ref{eqn:aweptsrc}.

\cite{SantosaSymes:00} use an analogous construction for the
second-order wave equation to give $L^2$ bounds on the point radiator
solution.

As mentioned in the Preliminaries section, a similar argument
establishes the existence of weak solutions for the surface source problem
\begin{eqnarray}
\label{eqn:awess}
\frac{\partial p}{\partial t} + \kappa \nabla \cdot {\bf v} &=&
                                                                w(x,y,t)\delta(z-z_s) \nonumber\\
\rho \frac{\partial {\bf v}}{\partial t} + \nabla p = 0 \nonumber\\
p,{\bf v}&=&0, t \ll 0
\end{eqnarray}
under Assumption D, that $\kappa=\kappa_0$ near $z=z_s$. An analytic
solution for $\kappa \equiv \kappa_0$ follows from that for the point
radiator problem, by superposition. Then a similar cutoff construction
and appeal to Theorem 1 of \cite{BlazekStolkSymes:13} proveds a weak
solution to \ref{eqn:awess}.

This construction also works via recourse to the progressing wave
expansion for the weaker
\begin{itemize}
\item[Assumption D']: $\epsilon > 0$ exists for which $\kappa$ is
smooth in the collar neigborhood $\{\bx: |z-z_s|<\epsilon\}$.
\end{itemize}
  
\append{1D Radiation Problem}
Begin with the 1D acoustics point source system. 
\begin{eqnarray}
\label{eqn:awe1dptsrc}
\frac{\partial p}{\partial t} +\kappa\frac{\partial 
  v}{\partial z} &=& w(t)\delta(z-z_s) \nonumber\\
\rho \frac{\partial v}{\partial t} + \frac{\partial p}{\partial 
  z}&=&0\nonumber\\
 p,v&=&0, t \ll 0. 
\end{eqnarray}
Since the right hand side is singular, so is the solution, so it must
be a solution in the weak sense. It follows from the weak solution
conditions that the pressure is continuous at $z=z_s$, whence $v$ must
have a discontinuity. 

Now assume that $\kappa=\kappa_0 \in \bR^+, \rho=\rho_0 \in \bR^+, c_0
= \sqrt{\kappa_0/\rho_0}$ are constant. 
In $z \ne z_s$, the right hand side 
vanishes, so the solution must be locally a combination of plane
waves; causality implies that
\[
p(z,t)=a\left(t -\frac{|z-z_s|}{c_0}\right), \, v(z,t)=\mbox{sgn}(z-z_s) b\left(t -
  \frac{|z-z_s|}{c_0}\right)
\]
From the second dynamical equation (Newton's law) it follows that $b =
a/(\rho_0 c_0)$. The singularity on the LHS of the first dynamical
equation (constitutive law) is
\[
\kappa_0 [v]_{z=z_s}\delta(z-z_s) =
2\kappa_0 b\delta(z-z_s) = 2c_0 a\delta(z-z_s).
\] 
This must in turn equal the RHS of the constitutive law, whence
$a=w/(2c_0)$. Thus
\begin{eqnarray}
\label{eqn:sol1dptsrc}
p(z,t) &=& \frac{1}{2c_0}w\left(t - \frac{|z-z_s|}{c_0}\right) \nonumber \\
v(z,t) &=& \mbox{sgn}(z-z_s)\frac{1}{2\kappa_0}w\left(t -\frac{|z-z_s|}{c_0}\right)
           \nonumber \\
\end{eqnarray}
This result (computation of the Green's function for the acoustic
system) permits an explicit expression for the system with a
space-time source:
\begin{eqnarray}
\label{eqn:awe1d}
\frac{\partial p}{\partial t} +\kappa_0\frac{\partial 
  v}{\partial z} &=& f(z,t) \nonumber\\
\rho_0 \frac{\partial v}{\partial t} + \frac{\partial p}{\partial 
  z}&=&0\nonumber\\
 p,v&=&0, t \ll 0. 
\end{eqnarray}
Since
\[
  f(z,t) = \int dz_1\,f(z_s,t)\delta(z-z_1)
\]
obtain
\begin{eqnarray}
\label{eqn:sol1dp}
p(z,t) &=& \frac{1}{2c_0}\int dz_1 f\left(z_1,t -
           \frac{|z-z_1|}{c_0}\right) \\
  \label{eqn:sol1dv}
v(z,t) &=& \frac{1}{2\kappa_0} \int dz_1 \mbox{sgn} (z-z_1) f\left(z_1,t - \frac{|z-z_1|}{c_0}\right)
\end{eqnarray}

\append{1D Born Approximation}

The perturbational system for \ref{eqn:awe1d} is:
\begin{eqnarray}
\label{eqn:dawe1d}
\frac{\partial \delta p}{\partial t} +\kappa\frac{\partial
  \delta v}{\partial z} + \delta \kappa\frac{\partial
  v}{\partial z} &=& 0 \nonumber\\
\rho \frac{\partial \delta v}{\partial t} + \frac{\partial \delta p}{\partial
  z}&=&0\nonumber\\
\delta p,\delta v&=&0, t \ll 0.
\end{eqnarray}

If $\kappa=\kappa_0, \rho=\rho_0 $ are constant, it is possible to develop explicit
expressions for the solution of this system. As before, only $\kappa$ will be
subject to perturbation in any of the problems considered in this
report, so assume that that $\delta\rho=0$.

From \ref{eqn:sol1dv}
\[
  \frac{\partial v}{\partial z}(z,t) = \frac{1}{\kappa_0} f(z,t) 
\]
\begin{equation}
  \label{eqn:sol1ddvdz}
 - \frac{1}{2\kappa_0c_0} \int\, dz_2\, \frac{\partial f}{\partial t}\left(z_2,t - \frac{|z-z_2|}{c_0}\right)
\end{equation}
Thus using equation \ref{eqn:sol1dp} and \ref{eqn:dawe1d}, 
\[
  \delta p(z,t) =- \frac{1}{2c_0} \int \, dz_1 \, \delta
  \kappa(z_1)\frac{\partial v}{\partial z}\left(z_1,t - \frac{|z-z_1|}{c_0}\right)
\]
\[
  =-\frac{1}{2\kappa_0c_0} \int \,dz_1\, \delta
  \kappa(z_1) f \left(z_1,t - \frac{|z-z_1|}{c_0}\right)
  \]
\begin{equation}
  \label{eqn:sol1ddp}
  + \frac{1}{4\kappa_0c_0^2} \int\,dz_2 \, \int \,dz_1\,\delta 
  \kappa(z_2) \frac{\partial f}{\partial t}\left(z_1,t - \frac{|z_1-z_2|+|z_2-z|}{c_0}\right)
\end{equation}

A convenient check on this calculation is available for constant
$\delta \kappa = \delta \kappa_0$. Directly perturb the RHS of equation 
\ref{eqn:sol1dp}, to obtain
\[
  \delta p(z,t) = -\frac{\delta c_0}{2 c_0^2} \int
  \,dz_1\,f\left(z_1,t-\frac{|z-z_1|}{c_0}\right)
  +\frac{\delta c_0}{2c_0^3}\int
  \,dz_1\,\frac{\partial f}{\partial
    t}\left(z_1,t-\frac{|z-z_1|}{c_0}\right)|z-z_1|
\]
Since
\[
  \delta c_0 = \delta \left(\frac{\kappa_0}{\rho_0}\right)^{1/2} =
  \frac{1}{2} \left(\frac{\kappa_0}{\rho_0}\right)^{-1/2}\frac{\delta
    \kappa_0}{\rho_0}
\]
\[
  = \frac{1}{2}\frac{\delta \kappa \rho_0^{1/2}}{\kappa_0^{1/2}\rho_0}
  \]
\[
=\frac{1}{2} \frac{\delta
  \kappa_0}{\kappa_0}\left(\frac{\kappa_0}{\rho_0}\right)^{1/2}
=\frac{1}{2} \frac{c_0\delta \kappa_0}{\kappa_0}
\]
the identity above can be rewritten as
\[
  \delta p(z,t) = -\frac{\delta \kappa_0}{4 \kappa_0 c_0} \int
  \,dz_1\,f\left(z_1,t-\frac{|z-z_1|}{c_0}\right)
  \]
\begin{equation}
  \label{eqn:dpraw} 
  +\frac{\delta \kappa_0}{4\kappa_0c_0^2}\int
  \,dz_1\,\frac{\partial f}{\partial
    t}\left(z_1,t-\frac{|z-z_1|}{c_0}\right)|z-z_1|
\end{equation}
The critical quantity is the integral in the second term:
\[
  \int \,dz_1\,\frac{\partial f}{\partial t}\left(z_1,t-\frac{|z-z_1|}{c_0}\right)|z-z_1|
\]
\[
  = \int_{-\infty}^z \,dz_1\,\frac{\partial f}{\partial
    t}\left(z_1,t-\frac{z-z_1}{c_0}\right)(z-z_1)
\]
\[
   + \int^{\infty}_z \,dz_1\,\frac{\partial f}{\partial t}\left(z_1,t-\frac{z_1-z}{c_0}\right)(z_1-z)
 \]
 \[
   =\int_{-\infty}^z \,dz_1\,\int_{z_1}^{z} \,dz_2\, \frac{\partial f}{\partial
     t}\left(z_1,t-\frac{z-z_2+z_2-z_1}{c_0}\right)
 \]
 \[
   + \int^{\infty}_z \,dz_1\,\int_{z}^{z_1}\,dz_2\,\frac{\partial
     f}{\partial t}\left(z_1,t-\frac{z_1-z_2 + z_2-z}{c_0}\right)
 \]
 Checking signs, one sees that this sum is equal to
 \[
   =\int_{-\infty}^z \,dz_1\,\int_{-\infty}^{\infty} \,dz_2\, \frac{\partial f}{\partial
     t}\left(z_1,t-\frac{|z-z_2|+|z_2-z_1|}{c_0}\right)
 \]
 \[
   + \int^{\infty}_z \,dz_1\,\int_{-\infty}^{\infty}\,dz_2\,\frac{\partial
     f}{\partial t}\left(z_1,t-\frac{|z_1-z_2| + |z_2-z|}{c_0}\right)
 \]
 \[
   -\int_{-\infty}^z \,dz_1\,\int_{-\infty}^{z_1} \,dz_2\, \frac{\partial f}{\partial
     t}\left(z_1,t-\frac{|z-z_2|+|z_2-z_1|}{c_0}\right)
 \]
\[
   -\int_{-\infty}^z \,dz_1\,\int_{z}^{\infty} \,dz_2\, \frac{\partial f}{\partial
     t}\left(z_1,t-\frac{|z-z_2|+|z_2-z_1|}{c_0}\right)
 \]
 \[
   - \int^{\infty}_z \,dz_1\,\int_{-\infty}^{z}\,dz_2\,\frac{\partial
     f}{\partial t}\left(z_1,t-\frac{|z_1-z_2| + |z_2-z|}{c_0}\right)
 \]
 \[
   - \int^{\infty}_z \,dz_1\,\int_{z_1}^{\infty}\,dz_2\,\frac{\partial
     f}{\partial t}\left(z_1,t-\frac{|z_1-z_2| + |z_2-z|}{c_0}\right)
 \]
\[
   =\int_{-\infty}^{\infty} \,dz_1\,\int_{-\infty}^{\infty} \,dz_2\, \frac{\partial f}{\partial
     t}\left(z_1,t-\frac{|z-z_2|+|z_2-z_1|}{c_0}\right)
 \]
 \[
   -\int_{-\infty}^z \,dz_1\,\int_{-\infty}^{z_1} \,dz_2\, \frac{\partial f}{\partial
     t}\left(z_1,t-\frac{z-z_2+z_1-z_2}{c_0}\right)
 \]
\[
   -\int_{-\infty}^z \,dz_1\,\int_{z}^{\infty} \,dz_2\, \frac{\partial f}{\partial
     t}\left(z_1,t-\frac{z_2-z+z_2-z_1|}{c_0}\right)
 \]
 \[
   - \int^{\infty}_z \,dz_1\,\int_{-\infty}^{z}\,dz_2\,\frac{\partial
     f}{\partial t}\left(z_1,t-\frac{z_1-z_2 + z-z_2}{c_0}\right)
 \]
 \[
   - \int^{\infty}_z \,dz_1\,\int_{z_1}^{\infty}\,dz_2\,\frac{\partial
     f}{\partial t}\left(z_1,t-\frac{z_2-z_1 + z_2-z}{c_0}\right)
 \]
\[
   =\int_{-\infty}^{\infty} \,dz_1\,\int_{-\infty}^{\infty} \,dz_2\, \frac{\partial f}{\partial
     t}\left(z_1,t-\frac{|z-z_2|+|z_2-z_1|}{c_0}\right)
 \]
 \[
   -\int_{-\infty}^z \,dz_1\,\int_{-\infty}^{z_1} \,dz_2\, \frac{\partial f}{\partial
     t}\left(z_1,t-\frac{z+z_1-2z_2}{c_0}\right)
 \]
\[
   -\int_{-\infty}^z \,dz_1\,\int_{z}^{\infty} \,dz_2\, \frac{\partial f}{\partial
     t}\left(z_1,t-\frac{2z_2-z-z_1}{c_0}\right)
 \]
 \[
   - \int^{\infty}_z \,dz_1\,\int_{-\infty}^{z}\,dz_2\,\frac{\partial
     f}{\partial t}\left(z_1,t-\frac{z_1+ z-2z_2}{c_0}\right)
 \]
 \[
   - \int^{\infty}_z \,dz_1\,\int_{z_1}^{\infty}\,dz_2\,\frac{\partial
     f}{\partial t}\left(z_1,t-\frac{2z_2-z_1-z}{c_0}\right)
 \]
\[
   =\int_{-\infty}^{\infty} \,dz_1\,\int_{-\infty}^{\infty} \,dz_2\, \frac{\partial f}{\partial
     t}\left(z_1,t-\frac{|z-z_2|+|z_2-z_1|}{c_0}\right)
 \]
 \[
   -\frac{c_0}{2}\int_{-\infty}^z \,dz_1\,\int_{-\infty}^{z_1} \,dz_2\, \frac{\partial }{\partial
     z_2}f\left(z_1,t-\frac{z+z_1-2z_2}{c_0}\right)
 \]
\[
   +\frac{c_0}{2}\int_{-\infty}^z \,dz_1\,\int_{z}^{\infty} \,dz_2\, \frac{\partial}{\partial
     z_2}f\left(z_1,t-\frac{2z_2-z-z_1}{c_0}\right)
 \]
 \[
   - \frac{c_0}{2}\int^{\infty}_z \,dz_1\,\int_{-\infty}^{z}\,dz_2\,\frac{\partial
     }{\partial z_2}f\left(z_1,t-\frac{z_1+ z-2z_2}{c_0}\right)
 \]
 \[
   +\frac{c_0}{2} \int^{\infty}_z \,dz_1\,\int_{z_1}^{\infty}\,dz_2\,\frac{\partial
     }{\partial z_2}f\left(z_1,t-\frac{2z_2-z_1-z}{c_0}\right)
 \]
\[
   =\int_{-\infty}^{\infty} \,dz_1\,\int_{-\infty}^{\infty} \,dz_2\, \frac{\partial f}{\partial
     t}\left(z_1,t-\frac{|z-z_2|+|z_2-z_1|}{c_0}\right)
 \]
 \[
   -\frac{c_0}{2}\int_{-\infty}^z \,dz_1\, f\left(z_1,t-\frac{z-z_1}{c_0}\right)
   -\frac{c_0}{2}\int_{-\infty}^z \,dz_1\,f\left(z_1,t-\frac{z-z_1}{c_0}\right)
 \]
 \[
   - \frac{c_0}{2}\int^{\infty}_z \,dz_1\,f\left(z_1,t-\frac{z_1-z}{c_0}\right)
   -\frac{c_0}{2} \int^{\infty}_z \,dz_1\,f\left(z_1,t-\frac{z_1-z}{c_0}\right)
 \]
 \[
   =\int_{-\infty}^{\infty} \,dz_1\,\int_{-\infty}^{\infty} \,dz_2\, \frac{\partial f}{\partial
     t}\left(z_1,t-\frac{|z-z_2|+|z_2-z_1|}{c_0}\right)
 \]
 \[
   -c_0\int_{-\infty}^{\infty} \,dz_1\, f\left(z_1,t-\frac{|z-z_1|}{c_0}\right)
 \]
 Insert the identity just established in the second term on the RHS of
 \ref{eqn:dpraw}:
 \[
  \delta p(z,t) = -\frac{\delta \kappa_0}{4 \kappa_0 c_0} \int
  \,dz_1\,f\left(z_1,t-\frac{|z-z_1|}{c_0}\right)
\]
\[
  +\frac{\delta \kappa_0}{4\kappa_0c_0^2}\left(\int_{-\infty}^{\infty} \,dz_1\,\int_{-\infty}^{\infty} \,dz_2\, \frac{\partial f}{\partial
      t}\left(z_1,t-\frac{|z-z_2|+|z_2-z_1|}{c_0}\right) \right.
\]
\[
  \left. -c_0\int_{-\infty}^{\infty} \,dz_1\,
    f\left(z_1,t-\frac{|z-z_1|}{c_0}\right)\right)
\]
\[
=-\frac{\delta \kappa_0}{2\kappa_0c_0}\int_{-\infty}^{\infty} \,dz_1\,
f\left(z_1,t-\frac{|z-z_1|}{c_0}\right)
\]
\begin{equation}
  \label{eqn:dpraw}
+  \frac{\delta \kappa_0}{4\kappa_0c_0^2}\int_{-\infty}^{\infty} \,dz_1\,\int_{-\infty}^{\infty} \,dz_2\, \frac{\partial f}{\partial
      t}\left(z_1,t-\frac{|z-z_2|+|z_2-z_1|}{c_0}\right)
  \end{equation}
which is identical to the expression \ref{eqn:sol1ddp} for the case of constant
$\delta \kappa = \delta \kappa_0$.

An important special case of the identity \ref{eqn:sol1ddp} is the 1D point source,
$f(z,t)=w(t)\delta(z-z_s)$: then
\[
  \delta p(z,t) = -\frac{\delta \kappa(z_s)}{2\kappa_0c_0}w\left(t - \frac{|z-z_s|}{c_0}\right)
\]
\begin{equation}
  \label{eqn:sol1ddppw}
  +\frac{1}{4\kappa_0c_0^2} \int \,dz_1\,\delta 
  \kappa(z_1) \frac{\partial w}{\partial t}\left(t - \frac{|z_s-z_1|+|z_1-z|}{c_0}\right)
\end{equation}

\append{Plane Waves}

Re-write the plane wave system \ref{eqn:awepw} as
\begin{eqnarray}
\label{eqn:awepw1}
\frac{\partial \tp}{\partial t} + \tk\frac{\partial
  \tv}{\partial z} &=& (1-c^2\xi^2)^{-1}\tf \nonumber\\
\rho \frac{\partial \tv}{\partial t} + \frac{\partial \tp}{\partial
  z}&=&0\nonumber\\
\tp,\tv&=&0, t \ll 0,
\end{eqnarray}
in which $\tk(\xi,z)=(1-c(z)^2\xi^2)^{-1}\kappa(z)$ is a scaled version of
bulk modulus. The corresponding wave velocity $\tc$ is given by
\[
\tc(\xi,z)=\sqrt{\tk/\rho} = \frac{c(z)}{\sqrt{1-c(z)^2\xi^2}} =
\left(\frac{1}{c(z)^2}-\xi^2\right)^{-1/2}.
\]

In effect, systen \ref{eqn:awepw1} is a parametrized 1D (space) wave
system, so the results of the last two appendices apply to the
homogeneous case, in which $\kappa=\kappa_0$ and $\rho=\rho_0$ are
independent of $z$. Comparing the plane wave system \ref{eqn:awepw1} with the 1D system
\ref{eqn:awe1d}, and using the 1D solution for homogeneous fluids
\ref{eqn:sol1dp},\ref{eqn:sol1dv}, obtain
\begin{eqnarray*}
\tp(\xi,z,t) &=& \frac{1}{2\tc_0(\xi)}(1-c_0^2\xi^2)^{-1}\int dz_s
                 \tf\left(\xi,z_s,t -
                 \frac{|z-z_s|}{\tc_0(\xi)}\right) \nonumber \\
\tv(\xi,z,t) &=& \frac{1}{2\rho_0 c_0}(1-c_0^2\xi^2)^{-1} \int dz_s \mbox{sgn} (z-z_s)\tf\left(\xi,z_s,t - \frac{|z-z_s|}{\tc_0(\xi)}\right)
           \nonumber \\
\end{eqnarray*}
which becomes
\begin{eqnarray}
\label{eqn:solpwp}
 \tp(\xi,z,t)   &=&\frac{1}{2c_0(1-c_0^2\xi^2)^{1/2}}\int dz_s 
                 \tf\left(\xi,z_s,t -
                    \frac{|z-z_s|}{\tc_0(\xi)}\right)  \\
  \label{eqn:solpwv}
\tv(\xi,z,t) &=& \frac{1}{2\kappa_0} \int dz_s \mbox{sgn} (z-z_s)\tf\left(\xi,z_s,t - \frac{|z-z_s|}{\tc_0(\xi)}\right)
\end{eqnarray}
after some simplification.

Accordingly, the plane-wave forward map is given by
\[
  \tS[\kappa_0]\tf(\xi,t) =\tp(\xi,z_r,t)
\]
\begin{equation}
\label{eqn:fwdpw1}
= \frac{1}{2c_0(1-c_0^2\xi^2)^{1/2}}\int dz \tf\left(\xi,z,t -
  \frac{|z_r-z|}{\tc_0(\xi)}\right)
\end{equation}
which replicates equation \ref{eqn:stmodhompw}. Equations
\ref{eqn:ssmodhompw} and \ref{eqn:ptmodhompw} follow by simple specializations.

The linearized forward map $D\tS[\kappa]$ is defined by
\begin{equation}
  \label{eqn:dfwdpw}
  D\tS[\kappa]\delta \kappa(\xi,t) = \delta \tp(\xi,z_r,t)
\end{equation}
Here $\tp$ and $\tv$ solve the linearized plane-wave system
\begin{eqnarray}
\label{eqn:dawepw1}
\frac{\partial \delta\tp}{\partial t} + \tk\frac{\partial
  \delta \tv}{\partial z} +  \delta \tk\frac{\partial
  \delta \tv}{\partial z}  &=& (1-c^2\xi^2)^{-2}\delta (c^2)\xi^2\tf \nonumber\\
\rho \frac{\partial \delta \tv}{\partial t} + \frac{\partial \delta \tp}{\partial
  z}&=&0\nonumber\\
\delta \tp,\delta \tv&=&0, t \ll 0,
\end{eqnarray}

Comparing \ref{eqn:dawepw1} with identity
\ref{eqn:dawe1d}, observe that the solution of \ref{eqn:dawepw1} for is
the sum of
\begin{itemize}
\item the solution of \ref{eqn:dawe1d} with $\tk, \delta \tk$
  substituted for $\kappa, \delta \kappa$, and the right hand side in
  the first equation of the system \ref{eqn:awe1d} for
  the reference fields $\tp, \tv$ replaced by $(1-c^2\xi^2)^{-1}\tf$;
\item the solution of \ref{eqn:awe1d} with $\tf$ replaced by
  $(1-c^2\xi^2)^{-2}\delta (c^2)\xi^2\tf$, and $\kappa_0$ replaced by $\tk_0$..
\end{itemize}

Expressions for linearized forward maps at homogeneous reference
models, $D\tS[\kappa_0]\delta \kappa$, follow this observation and the
results of the last two appendices. For the first summand, in
\ref{eqn:sol1ddp}, substitute $\tk_0$ for $\kappa_0$, $\delta \tk$ for
$\delta \kappa$, and $(1-c_0^2\xi^2)^{-1}\tf$ for $\tf$ to obtain
\[
-\frac{1}{2\tk_0(\xi)\tc_0(\xi)} \int \,dz_1\, \delta 
\tk(\xi,z_1)(1-c_0\xi^2)^{-1} \tf \left(\xi,z_1,t - \frac{|z-z_1|}{\tc_0(\xi)}\right)
\]
\[
  + \frac{1}{4\tk_0(\xi)\tc_0(\xi)^2} \int\,dz_2 \, \int \,dz_1\,\delta 
  \tk(\xi,z_1) (1-c_0\xi^2)^{-1}\frac{\partial \tf}{\partial t}\left(\xi,z_2,t - \frac{|z_2-z_1|+|z_1-z|}{\tc_0(\xi)}\right) 
\]
Since
\[
\delta \tk = \delta \left(\frac{\kappa}{1-\kappa \xi^2/\rho}\right) = \delta \kappa (1-c_0^2\xi^2)^{-2}
\]
at $\kappa=\kappa_0$,
this amounts to
\[
-\frac{1}{2\kappa_0(1-c_0^2\xi^2)^{-1}c_0(1-c_0^2\xi^2)^{-1/2}} \int \,dz_1\, \delta 
\kappa(z_1)(1-c_0\xi^2)^{-3} \tf \left(\xi,z_1,t - \frac{|z-z_1|}{\tc_0(\xi)}\right)
\]
\[
  + \frac{1}{4\kappa_0(1-c_0^2\xi^2)^{-1}c_0^2(1-c_0^2\xi^2)^{-1}} \int\,dz_2 \, \int \,dz_1\,\delta 
  \kappa(z_1) (1-c_0\xi^2)^{-3}\frac{\partial \tf}{\partial t}\left(\xi,z_2,t - \frac{|z_2-z_1|+|z_1-z|}{\tc_0(\xi)}\right) 
\]
\[
=  -\frac{1}{2\kappa_0c_0 (1-c_0\xi^2)^{3/2}} \int \,dz_1\, \delta 
\kappa(z_1) \tf \left(\xi,z_1,t - \frac{|z-z_1|}{\tc_0(\xi)}\right) 
\]
\begin{equation}
  \label{eqn:solpwdp1}
  + \frac{1}{4\kappa_0c_0^2(1-c_0^2\xi^2)} \int\,dz_2 \, \int \,dz_1\,\delta 
  \kappa(z_1) \frac{\partial \tf}{\partial t}\left(\xi,z_2,t - \frac{|z_2-z_1|+|z_1-z|}{\tc_0(\xi)}\right) 
\end{equation}

Note that
\[
  (1-c^2\xi^2)^{-2}\delta (c^2)\xi^2= (1-c^2\xi^2)^{-2}\xi^2\delta \kappa
  /\rho
\]
Therefore, from \ref{eqn:sol1dp}, the second summand identified above
is
\[
  =\frac{\xi^2}{2\tc(\xi)\rho_0}\int \,dz_1\, \delta 
\kappa(z_1)(1-c_0^2\xi^2)^{-2} \tf \left(\xi,z_1,t - \frac{|z-z_1|}{\tc_0(\xi)}\right)
\]
\[
  = \frac{\xi^2}{2c_0(1-c_0^2\xi^2)^{3/2}\rho_0}\int \,dz_1\, \delta 
\kappa(z_1) \tf \left(\xi,z_1,t - \frac{|z-z_1|}{\tc_0(\xi)}\right)
\]

\begin{equation}
  \label{eqn:solpwdp2}
=\frac{c_0^2\xi^2}{2\kappa_0c_0(1-c_0^2\xi^2)^{3/2}}\int \,dz_1\, \delta 
\kappa(z_1) \tf \left(\xi,z_1,t - \frac{|z-z_1|}{\tc_0(\xi)}\right)
\end{equation}
Adding the quantities \ref{eqn:solpwdp1} and \ref{eqn:solpwdp2},
obtain
\[
  \delta \tp(\xi,z,t) = -\frac{1}{2\kappa_0c_0(1-c_0^2\xi^2)^{1/2}}\int \,dz_1\, \delta 
  \kappa(z_1) \tf \left(\xi,z_1,t - \frac{|z-z_1|}{\tc_0(\xi)}\right)
  \]
\begin{equation}
  \label{eqn:solpwdp}
  + \frac{1}{4\kappa_0c_0^2(1-c_0^2\xi^2)} \int\,dz_2 \, \int \,dz_1\,\delta 
  \kappa(z_1)  \frac{\partial \tf}{\partial
    t}\left(\xi,z_2,t - \frac{|z_2-z_1|+|z_1-z|}{\tc_0(\xi)}\right)
  \end{equation}
Consequently 
\[
  D(\tS[\kappa]\tf)_{\kappa=\kappa_0}\delta \kappa(\xi,t) =
  -\frac{1}{2\kappa_0c_0(1-c_0^2\xi^2)^{1/2}}\int \,dz_1\, \delta 
  \kappa(z_1) \tf \left(\xi,z_1,t - \frac{|z_r-z_1|}{\tc_0(\xi)}\right)
\]
\begin{equation}
  \label{eqn:dmodhomst1app}
    + \frac{1}{4\kappa_0c_0^2(1-c_0^2\xi^2)} \int\,dz_2 \, \int \,dz_1\,\delta 
  \kappa(z_1)  \frac{\partial \tf}{\partial
    t}\left(\xi,z_2,t - \frac{|z_2-z_1|+|z_1-z_r|}{\tc_0(\xi)}\right)
\end{equation}
which is equation \ref{eqn:dmodhompwst1}. For a point source
$\tf(\xi,z,t) = w(t)\delta(z-z_s)$, this reduces to
\[
  D(\tS_p[\kappa]w)_{\kappa=\kappa_0}\delta \kappa(\xi,t) =
  -\frac{1}{2\kappa_0c_0(1-c_0^2\xi^2)^{1/2}} \delta 
  \kappa(z_s) w\left(t - \frac{|z_r-z_s|}{\tc_0(\xi)}\right)
\]
\begin{equation}
  \label{eqn:dmodhompt1}
    + \frac{1}{4\kappa_0c_0^2(1-c_0^2\xi^2)} \int \,dz\,\delta 
  \kappa(z) \frac{\partial w}{\partial
    t}\left(t - \frac{|z_s-z|+|z-z_r|}{\tc_0(\xi)}\right)
\end{equation}
which is equation \ref{eqn:dmodhompwpt}. 



\append{Zero-Weight Limit of Variable Projection}
As in the Preliminaries section, this discussion focuses on the plane wave
Surface Source objective, in the scaled variant \ref{eqn:ssepeninv},
reproduced here for convenience:
\begin{equation}
  \label{eqn:ssepeninv1}
  \kappa,\tu \mapsto \lambda^{-2}\|\td-\tS_s[\kappa]\tu\|^2 + \|\tA\tu\|^2
\end{equation}
Variable projection creates a function of $\kappa$ by minimizing this
function over $\tu$, to obtain
\[
\kappa \mapsto \frac{1}{\lambda^2}\|\tS[\kappa]\tu_{\lambda}[\kappa]-\td\|^2 + \|\tA
\tu_{\lambda}[\kappa]\|^2
\]
where $\tu_{\lambda}[\kappa]$ solves the normal equation:
\[
\tS[\kappa]^T\tS[\kappa]\tu  + \lambda^2\tA^T\tA\tu = \tS[\kappa]^T\td.
\]
Since $\tS[\kappa]$ is invertible, $\tu_{\lambda}[\kappa]$ is
bounded uniformly in $\lambda$ as $\lambda \rightarrow 0$. Let $\tu_0[\kappa] =
\tS[\kappa]^{-1}\td$. Then
\[
\tS[\kappa]^T\tS[\kappa](\tu_{\lambda}[\kappa]-\tu_0[\kappa])+\lambda^2\tA^T\tA\tu_{\lambda}[\kappa]
= 0,
\]
so $\tu_{\lambda}[\kappa] \rightarrow \tu_0[\kappa]$ as $\lambda
\rightarrow 0$. Consequently the scaled objective above becomes
\[
\frac{1}{\lambda^2}\|\tS[\kappa]\tu_{\lambda}[\kappa]-\td\|^2 + \|\tA 
\tu_{\lambda}[\kappa]\|^2
=\frac{1}{\lambda^2}\|\tS[\kappa](\tu_{\lambda}[\kappa]-\tu_0[\kappa])\|^2 + \|\tA 
\tu_{\lambda}[\kappa]\|^2
\]
\[
=\frac{1}{\lambda^2}\langle (\tu_{\lambda}[\kappa]-\tu_0[\kappa]),
\tS[\kappa]^T\tS[\kappa](\tu_{\lambda}[\kappa]-\tu_0[\kappa])\rangle+ \|\tA 
\tu_{\lambda}[\kappa]\|^2
\]
\[
=\frac{1}{\lambda^2}\langle (\tu_{\lambda}[\kappa]-\tu_0[\kappa]),
-\lambda^2\tA^T\tA \tu_{\lambda}[\kappa] \rangle + \|\tA\tu_{\lambda}[\kappa]\|^2
=\langle (\tu_{\lambda}[\kappa]-\tu_0[\kappa]),
-\tA^T\tA \tu_{\lambda}[\kappa] \rangle + \|\tA\tu_{\lambda}[\kappa]\|^2
\]
\begin{equation}
\label{eqn:j0def}
\rightarrow \|\tA\tu_0[\kappa]\|^2 \equiv 2 J_0[\kappa,\td].
\end{equation}
This $\lambda \rightarrow 0$ limit is the simplified objective used by
\cite{Symes:EAGE15} and mentioned in the Preliminaries section.

\append{OLD RESULTS}

The underlying hypothesis is that the data comes from a point
source. Extension methods encode such information in an annihilator,
an operator that vanishes for models that satisfy the hypothesis. For
SSE-FWI, a natural annilator is a variant on the operator introduced
for this purpose by \cite{HuangSymes:Geo18a,HuangSymes:Geo18b} for two
similar source extension methods, namely multiplication by offset,
also reminiscent of a now-standard annihilator for subsurface offset
introduced by \cite{stolk2001c}. In the plane wave domain,
multiplication by offset becomes 
\[
\tA = D_{\xi}I_t,
\]
that is, differentiation in $\xi$ and integration in $t$, in either
order.

The forward map $\tS$ for plane-wave transformed inverse problem maps
extended plane wave source wavelets $\tw(\xi,t)$ to plane wave data
traces (sampling of the plane-wave field at $z=0$, assuming this to be the
depth of sources and receivers, as I do here). I will regard this operator as a
function of the bulk modulus $\kappa(z)$, by assuming the density
$\rho$ to be fixed and homogeneous. 

$\tS[\kappa]$ is 
actually invertible, at least for $\kappa$ close to homogeneous. This conclusion follows for instance
from explicit expressions in two special cases: for homogeneous models
$\kappa=\kappa_0$, 
\[
\tS[\kappa_0]\tw(\xi,t) = a_0(\xi)\tw(\xi,t),
\]
and for a smooth model $\kappa_1$ with an embedded reflector at $z=z_1$,

\[
\wl(t)=\frac{1}{\sqrt{\lambda}}w_1\left(\frac{t}{\lambda}\right)
\]
is a family of wavelets depending on central wavelength $\lambda$. The
vertical travel time $\tau(\xi,z_1)$ is given by
\[
\tau(\xi,z_1) = \int_0^{z_1}\sqrt{\frac{1}{c^2}-\xi^2},\,\,c=\sqrt{\kappa/rho}.
\]

Since $\tS$ is invertible, it is possible to use the
simplified objective presented by
\cite{Symes:EAGE15}:
\begin{equation}
\label{eqn:dsobj}
J_0[\kappa]=\frac{1}{2}\|\tA \tS[\kappa]^{-1}\td\|^2
\end{equation}
A derivation of this limit case from the standard penalty formulation
of extended FWI 
appears in the last section. Inversion based on this type of objective
has been called ``inversion velocity analysis'' in the subsurface
offset context \cite[]{Herve2017},\cite[]{HouSymes:Geo18}, and is also the
basis of Adaptive Waveform Inversion
\cite{Warner:14,Warner:16}.

The main result pertains to the gradient at homogeneous
$\kappa=\kappa_0$ for data resulting from a single flat reflector
embedded in a smooth background:
\[
\tdl = \tS[\kappa_1]\wl
\]
I calculate the gradient of $J_0$ in this configuration.
The result is given in equation \ref{eqn:jgrad} in the last
section. Converted to spatial frequency via the Fourier transform, it
becomes
\begin{equation}
\label{eqn:jgradft-intro}
\widehat{\nabla J[\kappa_0]}(k) = -\frac{c_0}{16}\int\, d\xi\,a_1(\xi) 
\frac{1}{ik}\hat{u}_{\lambda}(\xi,k)D_{\xi}^2\overline{\hat{u}_{\lambda}(\xi,k)}
\end{equation}
where
\[
\hat{u}_{\lambda}(\xi,k) = \left(1 +
  \frac{R(\xi)}{a_0(\xi)}e^{4ik\tau(\xi,z_1)/\tc(\xi)}\right)\hat{\wl}\left(\frac{2k}{\tc(\xi)}\right) 
\]
and 
\[
\tc(\xi) = \left(\frac{1}{c_0}^2-\xi^2\right)^{-1/2}
\]
is the vertical plane wave velocity for homogenous wave velocity
$c_0 = \sqrt{\kappa_0/rho}$.

Then for any $k_{\rm max} >0$, $\xi_{\rm max} > 0$,
\[
\max \{\left|\hat{w}_{\lambda}\left(2k/\tc{\xi}\right)\right|:
|k|\le k_{\rm max}, |\xi|\le \xi_{\rm max} \} \rightarrow 0\mbox{ as }
\lambda \rightarrow 0.
\]
It follows immediately from equation \ref{eqn:jgradft-intro} that the
same is true of the gradient:
\begin{equation}
\label{eqn:bigdeal}
\max \{\left|\widehat{\nabla J[\kappa_0]}(k)\right|:
|k|\le k_{\rm max}, |\xi|\le \xi_{\rm max} \} \rightarrow 0\mbox{ as }
\lambda \rightarrow 0.
\end{equation}

Therefore the rate at which traveltime changes for any plane wave
component in the specified range, as the bulk modulus is changed along
the direction of the negative gradient, is vanishingly small as
$\lambda \rightarrow 0$. 

Otherwise put, for high-frequency reflection data, this method cannot
update the velocity away from a homogenous initial guess in a way that
is kinematically constructive.

It may even be possible to show that the update may be destructive, by
more careful examination of the gradient approximation. However, who
cares, really: it is established that SSE-FWI has similar behaviour to
FWI for at least one simple instance of reflection data.
\bibliographystyle{seg}
\bibliography{../../bib/masterref}